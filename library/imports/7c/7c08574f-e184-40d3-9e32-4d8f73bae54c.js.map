{"version":3,"sources":["assets\\framework\\extension\\mmcloud\\Cloud.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,sCAAiC;AACjC,gDAA0C;AAc1C;IAAA;IA8HA,CAAC;IAzHiB,oBAAc,GAA5B;QACI,IAAI,OAAO,GAAG,EAAE,CAAA;QAChB,IAAI,KAAK,GAAG,IAAI,CAAC;QACjB,IAAI,EAAE,GAAG,sBAAO,CAAC,UAAU,CAAC;QAC5B,IAAI,aAAa,EAAE;YACf,qCAAqC;YACrC,kBAAkB;YAClB,+BAA+B;SAClC;QACD,IAAI,MAAM,GAAG,IAAI,aAAG,EAAE,CAAC;QACvB,IAAI,aAAa,EAAE;SAClB;aAAM;YACH,MAAM,CAAC,SAAS,CAAC,SAAS,EAAE,4BAA4B,GAAG,EAAE,CAAC,KAAK,GAAG,qBAAqB,CAAC,CAAC;SAChG;QACD,OAAO,IAAI,OAAO,CAAC,CAAC,UAAC,OAAO,EAAE,MAAM;YAChC,IAAI,YAAY,GAAG,EAAE,KAAK,OAAA,EAAE,OAAO,EAAE,EAAE,CAAC,OAAO,EAAE,OAAO,SAAA,EAAE,IAAI,EAAE,EAAE,CAAC,MAAM,EAAE,CAAC;YAC5E,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC,IAAI,CAAC,UAAA,GAAG;gBAC9C,IAAI,GAAG,EAAE;oBACL,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;oBACvB,IAAI,CAAC,CAAC,KAAK,IAAI,CAAC,EAAE;wBACd,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAA;wBAChB,OAAM;qBACT;oBACD,IAAI,QAAQ,EAAE;wBACV,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;qBAC5B;oBACD,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;iBACnB;qBAAM,IAAI,GAAG,IAAI,aAAG,CAAC,IAAI,CAAC,OAAO,EAAE;oBAChC,MAAM,CAAC,SAAS,CAAC,CAAA;iBACpB;YACL,CAAC,CAAC,CAAA;QACN,CAAC,CAAC,CAAC,CAAA;IAEP,CAAC;IAEY,YAAM,GAAnB;;;;;4BAEU,qBAAM,IAAI,CAAC,cAAc,EAAE,CAAC,KAAK,CAAC,UAAA,CAAC;4BACrC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;wBACrB,CAAC,CAAC,EAAA;;wBAFF,GAAG,GAAG,SAEJ,CAAA;wBACF,IAAI,CAAC,GAAG,EAAE;4BACN,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;yBACpC;6BAAM;4BACH,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC;yBACrB;wBACD,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;;;;;KACrB;IAEM,aAAO,GAAd,UAAe,GAAgB;QAC3B,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC;IAC7B,CAAC;IAtDM,YAAM,GAAgB,EAAE,YAAY,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC;IACvD,WAAK,GAAmC,IAAI,CAAC;IAC7C,WAAK,GAAW,EAAE,CAAC;IAsDnB,UAAI,GAAW,iuEAoExB,CAAA;IACF,YAAC;CA9HD,AA8HC,IAAA;kBA9HoB,KAAK","file":"","sourceRoot":"/","sourcesContent":["import Net from \"../../misc/Net\";\nimport { SDKBase } from \"../SDKInterafce\";\n\nexport interface CloudFunc {\n    name: string,\n    status: number, // 0 , 1 \n    max: string,\n    ratio: string,\n}\n\nexport interface CloudConfig {\n    disFunc: { [index: string]: CloudFunc },\n    globalSwitch: number,\n}\n\nexport default class Cloud {\n    static config: CloudConfig = { globalSwitch: 1, disFunc: {} };\n    static funcs: { [index: string]: CloudFunc } = null;\n    static appid: string = \"\";\n\n    public static getCloudConfig(): Promise<CloudConfig> {\n        let channel = \"\"\n        let scene = 1001;\n        let gc = SDKBase.gameConfig;\n        if (CC_WECHATGAME) {\n            // let a = tt.getLaunchOptionsSync();\n            // scene = a.scene\n            // channel = a.query['channel']\n        }\n        let client = new Net();\n        if (CC_WECHATGAME) {\n        } else {\n            client.setHeader(\"Referer\", \"https://servicewechat.com/\" + gc.appId + \"/30/page-frame.html\");\n        }\n        return new Promise(((resolve, reject) => {\n            let dataTobesend = { scene, version: gc.version, channel, game: gc.gameId };\n            client.httpGet(gc.cloudUrl, dataTobesend).then(res => {\n                if (res) {\n                    let s = JSON.parse(res)\n                    if (s.errno != 0) {\n                        reject(s.errmsg)\n                        return\n                    }\n                    if (CC_DEBUG) {\n                        console.log(\"屏蔽接口返回\", s);\n                    }\n                    resolve(s.data);\n                } else if (res == Net.Code.Timeout) {\n                    reject(\"timeout\")\n                }\n            })\n        }))\n\n    }\n\n    static async reload() {\n        let res\n        res = await this.getCloudConfig().catch(v => {\n            console.error(v);\n        })\n        if (!res) {\n            res = JSON.parse(this.test).data;\n        } else {\n            this.config = res;\n        }\n        this.process(res);\n    }\n\n    static process(res: CloudConfig) {\n        this.funcs = res.disFunc;\n    }\n\n    static test: string = `{\n    \"code\": 200,\n    \"msg\": \"\",\n    \"data\": {\n        \"disFunc\": {\n            \"1\": {\n                \"name\": \"banner位移\",\n                \"status\": 1,\n                \"show_num\": \"100\",\n                \"show_per\": \"1\"\n            },\n            \"2\": {\n                \"name\": \"连胜奖励\",\n                \"status\": 1,\n                \"show_num\": \"100\",\n                \"show_per\": \"1\"\n            },\n            \"3\": {\n                \"name\": \"体力大礼包\",\n                \"status\": 1,\n                \"show_num\": \"100\",\n                \"show_per\": \"1\"\n            },\n            \"4\": {\n                \"name\": \"游戏页面banner\",\n                \"status\": 1,\n                \"show_num\": \"1000\",\n                \"show_per\": \"1\"\n            },\n            \"5\": {\n                \"name\": \"假分享失败控制\",\n                \"status\": 1,\n                \"show_num\": \"3\",\n                \"show_per\": \"1\"\n            },\n            \"6\": {\n                \"name\": \"banner刷新\",\n                \"status\": 1,\n                \"show_num\": \"3\",\n                \"show_per\": \"1\"\n            },\n            \"7\": {\n                \"name\": \"投放用户拉抽屉\",\n                \"status\": 1,\n                \"show_num\": \"3\",\n                \"show_per\": \"1\"\n            },\n            \"8\": {\n                \"name\": \"投放用户继续游戏拉抽屉\",\n                \"status\": 1,\n                \"show_num\": \"3\",\n                \"show_per\": \"0.5\"\n            },\n            \"9\": {\n                \"name\": \"电击枪领取弹窗\",\n                \"status\": 1,\n                \"show_num\": \"999\",\n                \"show_per\": \"1\"\n            },\n            \"10\": {\n                \"name\": \"关闭按钮展示\",\n                \"status\": 1,\n                \"show_num\": \"3\",\n                \"show_per\": \"1\"\n            }\n        },\n        \"adSwitch\": 1,\n    }\n}`\n}\n\n"]}