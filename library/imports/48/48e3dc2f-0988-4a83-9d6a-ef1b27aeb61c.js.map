{"version":3,"sources":["assets\\Game\\Scripts\\Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { evt } from \"../../framework/core/event\";\r\n\r\nimport LevelLoader from \"./LevelLoader\";\r\nimport { PlayerInfo } from \"./Common/Base/PlayerInfo\";\r\nimport Device from \"../../framework/misc/Device\";\r\nimport ccUtil from \"../../framework/utils/ccUtil\";\r\nimport Platform from \"../../framework/extension/Platform\";\r\nimport LoadingScene from \"./Common/Base/LoadingScene\";\r\nimport KeyToggle from \"./KeyToggle\";\r\nimport MeshSprite from \"../../framework/extension/render/mesh-sprite\";\r\nimport { UserInfo } from \"../../framework/extension/weak_net_game/UserInfo\";\r\nimport StatHepler from \"../../framework/extension/aldsdk/StatHelper\";\r\n\r\nimport FSM from \"../../framework/core/FSM\";\r\nimport { PrefabLoaderDelegate } from \"../../framework/ui/controller/PrefabLoader\";\r\nimport Switcher from \"../../framework/ui/controller/Switcher\";\r\nimport { umeng } from \"../../framework/extension/aldsdk/umeng\";\r\nimport wegame from \"./sdk/wegame\";\r\nimport mmgame from \"../../framework/extension/mmcloud/mmgame\";\r\nimport { Toast } from \"../../framework/ui/ToastManager\";\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nenum State {\r\n    Normal,\r\n    Hint,\r\n}\r\n\r\n@ccclass\r\nexport default class Game extends cc.Component implements PrefabLoaderDelegate {\r\n\r\n    @property(cc.Node)\r\n    guide: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    tili: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    xingxing: cc.Node = null;\r\n\r\n    @property(cc.Sprite)\r\n    bg: cc.Sprite = null;\r\n\r\n    @property(cc.Node)\r\n    close_btn: cc.Node = null;\r\n\r\n    @property(cc.Label)\r\n    level_str: cc.Label = null;\r\n\r\n    @property(cc.Node)\r\n    tip_str: cc.Node = null;\r\n\r\n    @property(Switcher)\r\n    star_switch: Switcher = null;\r\n\r\n    loader: LevelLoader = null;\r\n\r\n    static instance: Game = null;\r\n    isOver: boolean = true;\r\n\r\n    wallbg: MeshSprite = null;\r\n\r\n    star: number = 0;\r\n\r\n    fsm: FSM;\r\n\r\n    static debug: boolean = false;\r\n    isUsedMagnet: boolean = false;\r\n\r\n    onLoad() {\r\n        Game.instance = this;\r\n        cc.director.getCollisionManager().enabled = true;\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        // cc.director.getPhysicsManager().enabledAccumulator = true;\r\n        // cc.director.getPhysicsManager().debugDrawFlags =\r\n        //     cc.PhysicsManager.DrawBits.e_aabbBit |\r\n        //     // cc.PhysicsManager.DrawBits.e_pairBit |\r\n        //     // cc.PhysicsManager.DrawBits.e_centerOfMassBit |\r\n        //     cc.PhysicsManager.DrawBits.e_jointBit |\r\n        //     cc.PhysicsManager.DrawBits.e -[];`./hapeBit\r\n        //     ;\r\n        this.fsm = this.addComponent(FSM);\r\n        this.fsm.init(this, State)\r\n        this.fsm.enterState(State.Normal);\r\n\r\n        let node = new cc.Node();\r\n\r\n        let body = node.addComponent(cc.RigidBody);\r\n        body.type = cc.RigidBodyType.Static;\r\n        if (CC_DEBUG) {\r\n            // add mouse joint\r\n            let joint = node.addComponent(cc.MouseJoint);\r\n            joint.mouseRegion = this.node;\r\n        }\r\n\r\n        node.parent = this.node;\r\n\r\n        evt.on(\"Game.win\", this.onWin, this);\r\n        evt.on(\"Game.lose\", this.onLose, this)\r\n        evt.on(\"Game.catch\", this.onCatched, this);\r\n        evt.on(\"Game.hello\", this.onSayHello, this);\r\n        evt.on(\"Game.keyMoved\", this.onKeyMoved, this);\r\n        evt.on(\"Game.getTili\", this.onGetTili, this);\r\n        evt.on(\"Game.getstar\", this.onGetStar, this);\r\n        evt.on(\"PlayerInfo.star\", this.onChangeStar, this)\r\n        evt.on(\"UISkin.checkLock\", this.check_lockSkin, this);\r\n        evt.on(\"Main.skin\", this.onMainSkin, this);\r\n\r\n        this.loader = this.getComponentInChildren(LevelLoader);\r\n        this.loader.delegate = this;\r\n        this.loader.onLevelLoaded.add(this.onLevelLoaded, this);\r\n        if (!Game.debug) {\r\n            if (PlayerInfo.guide == 0) {\r\n                //加载新手引导关\r\n                PlayerInfo.playinglevel = 1;\r\n                this.loader.level = 1;\r\n                PlayerInfo.guide = 1;\r\n                PlayerInfo.save(\"guide\")\r\n            } else {\r\n                this.loader.level = PlayerInfo.getCurrentPlayingLevel();\r\n            }\r\n        }\r\n        let bg = this.node.getChildByName(\"bg\");\r\n        bg.on(cc.Node.EventType.TOUCH_END, this.onClickBg, this);\r\n\r\n\r\n        Platform.hideBannerAd();\r\n\r\n    }\r\n\r\n    onLoadPrefab(lvIndex: any, path: any) {\r\n        if (PlayerInfo.isPlayingDaily) {\r\n            let d = csv.daily_level.get(lvIndex)\r\n            return ccUtil.getRes(path + \"/\" + d.number, cc.Prefab)\r\n        } else {\r\n            let d = csv.level.get(lvIndex)\r\n            return ccUtil.getRes(path + \"/\" + d.number, cc.Prefab).catch(v => {\r\n                // back \r\n                Toast.make(\"未找到该关卡,请去商店获取完整版本!\")\r\n                this.scheduleOnce(v => {\r\n                    LoadingScene.goto(\"Main\")\r\n                }, 2)\r\n            })\r\n        }\r\n\r\n\r\n    }\r\n\r\n    onClickBg(e) {\r\n        //点击背景切换方向\r\n        evt.emit('Game.changeRoleDir')\r\n        this.activeGame();\r\n    }\r\n\r\n    onMainSkin() {\r\n        LoadingScene.goto(\"Skin\");//, TwoType.Skin\r\n    }\r\n\r\n    async onGetStar(pos) {\r\n        this.star += 1;\r\n        ccUtil.playFlyCoin(this.xingxing, this.xingxing.parent\r\n            , ccUtil.getWorldPosition(pos)\r\n            , ccUtil.getWorldPosition(this.star_switch.node)\r\n            , { num: 1.0 });\r\n        await evt.sleep(0.3);\r\n        this.star_switch.index = Math.min(this.star, 3);\r\n    }\r\n\r\n    onChangeStar() {\r\n        csv.Skin.values.forEach(v => {\r\n            if (v.unlockType == 2 && !PlayerInfo.isSkinUnlocked(v.id) && PlayerInfo.star >= v.unlock2) {\r\n                // PlayerInfo.unlockSkin(v.id);\r\n                vm.show(\"Prefabs/UI/UIUnlockSkin\", v.id);\r\n            }\r\n        });\r\n    }\r\n\r\n    onGetTili(worldpos, num) {\r\n        ccUtil.playFly(this.tili, 1.0, num)\r\n\r\n        // ccUtil.playFlyCoin(this.tili, this.tili.parent, worldpos, ccUtil.getWorldPosition(this.tili), { dur: 1.0, interval: 0.2, num })\r\n    }\r\n\r\n    lastKey: KeyToggle = null\r\n    //同一把钥匙 的点击次数\r\n    sameKeyCount: number = 0;\r\n\r\n    onKeyMoved(key) {\r\n        if (this.isOver) return;\r\n\r\n        // if (this.lastKey == key) {\r\n        //     this.sameKeyCount++;\r\n        //     if (this.sameKeyCount >= 4) {\r\n        //         // Toast.make(\"点击任意位置，改变行走方向!\")\r\n        //         this.sameKeyCount = 0;\r\n        //     }\r\n        // } else {\r\n        //     this.sameKeyCount = 0;\r\n        // }\r\n        // this.lastKey = key;\r\n    }\r\n\r\n    startGame() {\r\n        // let readyNode = this.node.getChildByName(\"ready\")\r\n        // readyNode.active = false;\r\n\r\n        evt.emit(\"Game.onStarted\", this)\r\n        this.isOver = false;\r\n        PlayerInfo.resetLevel();\r\n        umeng.startLevel(`level${PlayerInfo.getCurrentPlayingLevel() + (PlayerInfo.isPlayingDaily ? 300 : 0)}`);\r\n    }\r\n\r\n    onSayHello() {\r\n        Device.playSfx(\"hello\")\r\n    }\r\n\r\n\r\n    onLoadFinished(lv) {\r\n        if (lv) {\r\n            this.loader.loadPrefab(\"Prefabs/Levels/\" + lv)\r\n        }\r\n    }\r\n\r\n\r\n    onDestroy() {\r\n\r\n        Game.instance = null;\r\n        Game.debug = false;\r\n        evt.off(this);\r\n        cc.audioEngine.stopAll();\r\n    }\r\n\r\n    start() {\r\n        this.close_btn.active = false;\r\n        let w = cc.winSize.width;\r\n        let h = cc.winSize.height;\r\n        if (w / h > 0.7) {\r\n            //ipad or other pad \r\n            let canvas = this.node.getComponent(cc.Canvas)\r\n            canvas.fitHeight = true;\r\n            canvas.fitWidth = false;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    check_lockSkin() {\r\n        UserInfo.isunlock_men = 0;\r\n        UserInfo.isunlock_girl = 0;\r\n        UserInfo.isunlock_theme = 0;\r\n        for (let i = 1; i <= 5; i++) {\r\n            UserInfo[`isunlock_girl${i}`] = 0;\r\n            UserInfo[`isunlock_men${i}`] = 0;\r\n        }\r\n\r\n        for (let i = 1; i <= csv.Skin.values.length; i++) {\r\n            let data = csv.Skin.get(i);\r\n            if (((PlayerInfo.level >= data.unlock1 && data.unlockType == 1) || (data.unlockType == 2 && PlayerInfo.star >= data.unlock2))\r\n                && !PlayerInfo.isSkinUnlocked(data.id)) {\r\n                if (data.type == 1) {\r\n                    UserInfo.isunlock_girl = 1;\r\n                } else if (data.type == 2) {\r\n                    UserInfo.isunlock_men = 1;\r\n                } else if (data.type == 3) {\r\n                    UserInfo.isunlock_theme = 1;\r\n                }\r\n                if (data.subType < 5) {\r\n                    if (data.type == 1) {\r\n                        UserInfo[`isunlock_girl${data.subType + 1}`] = 1;\r\n                    } else if (data.type == 2) {\r\n                        UserInfo[`isunlock_men${data.subType + 1}`] = 1;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onWin() {\r\n        umeng.finishLevel(`level${PlayerInfo.getCurrentPlayingLevel() + (PlayerInfo.isPlayingDaily ? 300 : 0)}`);\r\n        //游戏胜利\r\n        if (this.isOver)\r\n            return;\r\n        Device.playSfx(\"hug\")\r\n        this.isOver = true;\r\n        this.scheduleOnce(this.openWin, 0.5);\r\n    }\r\n\r\n    openWin() {\r\n        if (mmgame.isCheatOpen(\"interstitial_on_level_end\")) {\r\n            Platform.showInterstitial()\r\n        }\r\n        if (PlayerInfo.playinglevel == PlayerInfo.level && PlayerInfo.playinglevel == 10) {\r\n            vm.show(\"Prefabs/UI/UIFreeProp\", () => {\r\n                vm.show(\"Prefabs/UI/UIWin\");\r\n            })\r\n        } else {\r\n            vm.show(\"Prefabs/UI/UIWin\");\r\n        }\r\n    }\r\n\r\n    changeBg() {\r\n        let num = Math.ceil(Math.random() * 4);\r\n\r\n        // if (PlayerInfo.isPlayingDaily) {\r\n        let count = Math.ceil(Math.random() * 3) + 6;\r\n        ccUtil.setDisplay(this.bg, \"Img/level/theme/bg_\" + UserInfo.theme);\r\n        // }\r\n        // else {\r\n        //     console.log('change bg ' + num)\r\n        //     ccUtil.setDisplay(this.bg, \"ui/bg/bg_\" + num);\r\n        // }\r\n    }\r\n\r\n    onCatched(param) {\r\n        evt.emit(\"Game.lose\", param);\r\n    }\r\n\r\n    onLevelLoaded(node: cc.Node, lvIndex) {\r\n        // ttsdk.start_recorder();\r\n        PlayerInfo.isPlayingSpecial = false;\r\n        let wallnode = node.getChildByName(\"bg\")\r\n        if (wallnode) {\r\n            this.wallbg = wallnode.getComponent(MeshSprite);\r\n            this.wallbg.diffuseColor = cc.color(83, 130, 151, 255);\r\n            ccUtil.getRes(\"Prefabs/shadow\", cc.Prefab).then(v => {\r\n                let n = cc.instantiate(v);\r\n                n.parent = this.wallbg.node;\r\n            })\r\n            // this.wallbg.color = cc.color().fromHEX(\"#5F8394\")\r\n        }\r\n        // this.isOver = false;\r\n        this.changeBg();\r\n        this.level_str.string = (PlayerInfo.isPlayingDaily ? \"挑战-\" : \"关卡-\") + PlayerInfo.getCurrentPlayingLevel();\r\n\r\n        if (UserInfo.isNew)\r\n            StatHepler.sendPath(\"新用户关卡开始人数\", \"关卡\", PlayerInfo.playinglevel);\r\n        StatHepler.sendPath(\"所有用户关卡开始人数\", \"关卡\", PlayerInfo.playinglevel);\r\n\r\n        evt.emit(\"Game.onLevelLoaded\", lvIndex)\r\n        PlayerInfo.onStartLevel();\r\n\r\n        //新手引导 关卡\r\n        // if (lvIndex != 1 || (lvIndex === 8 && PlayerInfo.level != 8)) {\r\n        //     let ready = this.node.getChildByName(\"ready\")\r\n        //     if (ready) {\r\n        //         ready.active = true;\r\n        //         ready.on(cc.Node.EventType.TOUCH_START, this.startGame, this)\r\n        cc.director.getPhysicsManager().enabled = false;\r\n        //     }\r\n        // } else {\r\n        this.startGame();\r\n        // }\r\n        Device.playBGM(\"BGM\" + UserInfo.theme);\r\n        if (UserInfo.isNew) {\r\n            Platform.sendUmengEvt(\"level_start_new\", PlayerInfo.playinglevel.toString());\r\n        }\r\n        else {\r\n            Platform.sendUmengEvt(\"level_start_all\", PlayerInfo.playinglevel.toString());\r\n\r\n        }\r\n        this.star = 0;\r\n        this.star_switch.index = 0;\r\n\r\n        let walls = this.loader.node.children[0].getChildByName(\"walls\");\r\n        for (let i = 0; i < walls.childrenCount; i++) {\r\n            let spr = walls.children[i].getComponent(cc.Sprite);\r\n            spr.type = cc.Sprite.Type.TILED;\r\n            if (spr.node.width < spr.node.height) {\r\n                spr.node.width = 35\r\n                ccUtil.setDisplay(spr, \"Img/level/theme/zhuan_\" + UserInfo.theme);\r\n            }\r\n            else {\r\n                spr.node.height = 40\r\n                ccUtil.setDisplay(spr, \"Img/level/theme/zhuan_v_\" + UserInfo.theme);\r\n            }\r\n        }\r\n\r\n        let caos = this.loader.node.children[0].getChildByName(\"cao\");\r\n        for (let i = 0; i < caos.childrenCount; i++) {\r\n            let node = caos.children[i];\r\n            let spr = node.getComponent(cc.Sprite)\r\n            ccUtil.setDisplay(spr, \"Img/level/theme/jinshucao_\" + UserInfo.theme);\r\n            if (node.name.indexOf(\"short\") >= 0) {\r\n                if (node.angle == 90) {\r\n                    node.height = 30;\r\n                } else {\r\n                    node.height = 40;\r\n                }\r\n            } else {\r\n                //long \r\n                ccUtil.changeParent(node, walls, -1);\r\n                i--;\r\n            }\r\n        }\r\n        let bg = this.loader.node.children[0].getChildByName(\"bg\");\r\n        // bg.active = false;\r\n        bg.getComponent(MeshSprite);\r\n        ccUtil.setDisplay(bg.getComponent(MeshSprite), \"textures/tietu_\" + UserInfo.theme);\r\n        // }\r\n        this.isUsedMagnet = false;\r\n        if (PlayerInfo.isPlayingDaily && ((PlayerInfo.playingDailyLevel % 5) == 0)) {\r\n            PlayerInfo.isPlayingSpecial = true;\r\n            let data = csv.daily_level.get(PlayerInfo.playingDailyLevel);\r\n            this.tip_str.active = true;\r\n            this.tip_str.getComponentInChildren(cc.Label).string = \"任务：\" + data.task;\r\n            vm.show(\"Prefabs/UI/UIMission\", \"任务：\" + data.task);\r\n        } else {\r\n            this.tip_str.active = false;\r\n        }\r\n\r\n        if (!PlayerInfo.isPlayingDaily && PlayerInfo.playinglevel === 5 && PlayerInfo.level === 5) {\r\n            vm.show(\"Prefabs/UI/UIBoxGuide\", 0);\r\n        }\r\n\r\n        //判断是否是第一次进该章节\r\n        // let c = PlayerInfo.getChapter(PlayerInfo.playinglevel);\r\n        // let bNew = PlayerInfo.isChapterNew(c)\r\n        // if (c > 1) {\r\n        //     if (bNew) {\r\n        //         vm.show(\"Prefabs/story/help\", c)\r\n        //         PlayerInfo.markChapterOld(c);\r\n        //     }\r\n        // }\r\n        if ((PlayerInfo.level > 10 && !PlayerInfo.isPlayingDaily)) {\r\n            PlayerInfo.isUnlock_Prop = true;\r\n            this.node.getChildByName(\"ItemsGroup\").active = true;\r\n        }\r\n    }\r\n\r\n    activeGame() {\r\n        if (cc.director.getPhysicsManager().enabled == false)\r\n            cc.director.getPhysicsManager().enabled = true;\r\n    }\r\n\r\n    onLose() {\r\n        umeng.failLevel(`level${PlayerInfo.getCurrentPlayingLevel() + (PlayerInfo.isPlayingDaily ? 300 : 0)}`);\r\n        if (this.isOver)\r\n            return;\r\n        this.isOver = true;\r\n        if (mmgame.isCheatOpen(\"interstitial_on_level_end\")) {\r\n            Platform.showInterstitial()\r\n        }\r\n        if (UserInfo.lose_num >= csv.Config.Show_AD_Lose) {\r\n            UserInfo.lose_num = 1;\r\n            if (csv.Config.Show_AD_Lose_Skip) {\r\n                Platform.showInterstitial(_ => {\r\n                    Device.playSfx(\"ohno\")\r\n                    vm.show(\"Prefabs/UI/UILose\");\r\n                }, this, _ => {\r\n                    Device.playSfx(\"ohno\")\r\n                    vm.show(\"Prefabs/UI/UILose\");\r\n                })\r\n            }\r\n            else {\r\n                Platform.watch_video(_ => {\r\n                    Device.playSfx(\"ohno\")\r\n                    vm.show(\"Prefabs/UI/UILose\");\r\n                }, this, _ => {\r\n                    Device.playSfx(\"ohno\")\r\n                    vm.show(\"Prefabs/UI/UILose\");\r\n                })\r\n            }\r\n        }\r\n        else {\r\n            UserInfo.lose_num += 1;\r\n            Device.playSfx(\"ohno\")\r\n            vm.show(\"Prefabs/UI/UILose\");\r\n        }\r\n\r\n    }\r\n\r\n    click_pause() {\r\n        // evt.emit('Game.pause');\r\n        // cc.director.pause();\r\n        vm.show(\"Prefabs/UI/UIPause\");\r\n    }\r\n\r\n    click_skip() {\r\n\r\n        vm.show(\"Prefabs/UI/UISkip\");\r\n    }\r\n\r\n    //刷新\r\n    click_return() {\r\n        // if (UserInfo.return_num >= csv.Config.Show_AD_Return) {\r\n        //     UserInfo.return_num = 1;\r\n        //     if (csv.Config.Show_AD_Return_Skip) {\r\n        //         Platform.showInterstitial(_ => {\r\n        //             LoadingScene.goto(\"Game\");\r\n        //             evt.emitDelay(5, \"Game.hintUser\")\r\n        //         }, this, _ => {\r\n        //             LoadingScene.goto(\"Game\");\r\n        //             evt.emitDelay(5, \"Game.hintUser\")\r\n        //         })\r\n        //     }\r\n        //     else {\r\n        //         Platform.watch_video(_ => {\r\n        //             LoadingScene.goto(\"Game\");\r\n        //             evt.emitDelay(5, \"Game.hintUser\")\r\n        //         }, this, _ => {\r\n        //             LoadingScene.goto(\"Game\");\r\n        //             evt.emitDelay(5, \"Game.hintUser\")\r\n        //         })\r\n        //     }\r\n        // }\r\n        // else {\r\n        // UserInfo.return_num += 1;\r\n        if (PlayerInfo.labour <= 0) {\r\n            vm.show(\"Prefabs/UI/UIGetLabour\", null, true);\r\n            return;\r\n        }\r\n        PlayerInfo.labour--;\r\n        PlayerInfo.save(\"labour\")\r\n        LoadingScene.goto(\"Game\");\r\n        // evt.emitDelay(5, \"Game.hintUser\")\r\n        // }\r\n\r\n    }\r\n\r\n    click_labour() {\r\n\r\n        vm.show(\"Prefabs/UI/UIGetLabour\", null, true);\r\n    }\r\n\r\n    hideGuide() {\r\n        // this.guide.active = false;\r\n    }\r\n\r\n    ///////////////////////////[state routine]////////////////////////////\r\n    onEnter_Normal() {\r\n\r\n    }\r\n\r\n    onUpdate_Normal() {\r\n        if (this.fsm.timeElapsed > 20) {\r\n            //20秒后开启提示按钮\r\n            //提示玩家 \r\n            this.fsm.changeState(State.Hint);\r\n        }\r\n    }\r\n\r\n    onEnter_Hint() {\r\n        evt.emit(\"Game.hintUser\")\r\n    }\r\n\r\n\r\n\r\n}\r\n"]}