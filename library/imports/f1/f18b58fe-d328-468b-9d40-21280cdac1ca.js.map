{"version":3,"sources":["assets\\Game\\Scripts\\Bomb.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Shake } from \"../../framework/misc/BoostsAction\";\r\nimport { evt } from \"../../framework/core/event\";\r\nimport SkeletonBase from \"./SkeletonBase\";\r\nimport ccUtil from \"../../framework/utils/ccUtil\";\r\nimport Device from \"../../framework/misc/Device\";\r\nimport RemoveOutOfView from \"./RemoveOutOfView\";\r\nimport Signal from \"../../framework/core/Signal\";\r\nimport Game from \"./Game\";\r\nimport Role from \"./Role\";\r\n\r\nlet { ccclass, property, executeInEditMode } = cc._decorator\r\n@ccclass\r\n@executeInEditMode\r\nexport default class Bomb extends SkeletonBase {\r\n\r\n    @property(cc.Label)\r\n    label: cc.Label = null;\r\n\r\n    @property({ displayName: \"剩余时间\" })\r\n    _timeLeft: number = 0;\r\n\r\n    onTimeLeftChanged: Signal = new Signal();\r\n\r\n    @property\r\n    get timeLeft() {\r\n        return this._timeLeft\r\n    }\r\n\r\n    @property(cc.Animation)\r\n    bombExplosion: cc.Animation = null;\r\n\r\n    @property(cc.Animation)\r\n    preExplosion: cc.Animation = null;\r\n\r\n\r\n    @property(cc.Node)\r\n    node_tooltip: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    node_light: cc.Node = null;\r\n\r\n    holder: cc.Node = null;\r\n\r\n    set timeLeft(v) {\r\n        this._timeLeft = v;\r\n        this.onTimeLeftChanged.fire(v);\r\n        this.label.string = v.toString()\r\n    }\r\n    onece = true;\r\n\r\n    collider: cc.PhysicsCollider;\r\n\r\n    onDestroy() {\r\n        evt.emit('Game.bombDes');\r\n        evt.off(this);\r\n    }\r\n\r\n    start() {\r\n        evt.on(\"Game.onStarted\", this.onGameStarted, this)\r\n        evt.on(\"Game.win\", this.onWin, this)\r\n        evt.on(\"Game.lose\", this.onGameLose, this);\r\n        evt.on(\"Game.pause\", this.onGameLose, this);\r\n        evt.on(\"Game.resume\", this.onGameStarted, this);\r\n        this.label.string = this._timeLeft.toString()\r\n        this.preExplosion.on(\"finished\", this.playSecondExplode, this)\r\n        this.collider = this.getComponent(cc.PhysicsCollider);\r\n        if (!Game.instance.isOver) {\r\n            this.schedule(this.countdown, 1)\r\n        }\r\n        let roov = this.getOrAddComponent(RemoveOutOfView);\r\n        roov.onOffScreen.on(this.onOffScreen, this);\r\n    }\r\n\r\n    onWin() {\r\n        this.unschedule(this.countdown);\r\n    }\r\n\r\n    onGameLose() {\r\n        this.unschedule(this.countdown);\r\n    }\r\n\r\n    onGameStarted() {\r\n        this.schedule(this.countdown, 1)\r\n\r\n    }\r\n\r\n    onOffScreen() {\r\n    }\r\n\r\n    countdown() {\r\n        this.timeLeft--\r\n        if (this.timeLeft <= 3) {\r\n            this.label.node.color = cc.Color.RED\r\n            this.startShake()\r\n        } else {\r\n            this.label.node.color = cc.Color.WHITE;\r\n            this.stopShake()\r\n        }\r\n        if (this.timeLeft <= 0) {\r\n            this.unschedule(this.countdown);\r\n            this.explode();\r\n        }\r\n    }\r\n\r\n    get isHiding() {\r\n        return this.node_tooltip.active == false;\r\n    }\r\n\r\n    hide() {\r\n        this.node.stopAllActions();\r\n        this.node_tooltip.active = false\r\n        let display = this.getComponent(cc.Sprite)\r\n        display && (display.enabled = false);\r\n        this.node_light.active = false;\r\n\r\n    }\r\n\r\n    show() {\r\n        this.node_tooltip.active = true;\r\n        let display = this.getComponent(cc.Sprite)\r\n        display && (display.enabled = true);\r\n        this.node_light.active = true;\r\n    }\r\n\r\n    goAway(dir) {\r\n        this.collider.enabled = false;\r\n        this.unschedule(this.countdown);\r\n        this.stopShake();\r\n        this.body.linearDamping = 0;\r\n        this.body.linearVelocity = cc.v2(dir * 1000, 1000)\r\n    }\r\n\r\n\r\n    shakeAction: cc.Action;\r\n\r\n    startShake() {\r\n        if (this.shakeAction) {\r\n            return;\r\n        }\r\n        this.shakeAction = this.node.runAction(Shake.create(3.0, 2, 0))\r\n        // this.shakeAction = this.node.runAction(cc.blink(3,3))\r\n    }\r\n\r\n    stopShake() {\r\n        this.node.stopAction(this.shakeAction)\r\n        this.shakeAction = null\r\n    }\r\n\r\n    drop(pos) {\r\n        this.show();\r\n        this.scheduleOnce(this.doDrop.bind(this, pos))\r\n\r\n        // this.body.angularVelocity = 1500;\r\n    }\r\n\r\n    doDrop(pos) {\r\n        this.node.setPosition(pos)\r\n        this.body.gravityScale = 10;\r\n        this.body.linearDamping = 0;\r\n        this.body.linearVelocity = cc.v2(0, 1000);\r\n    }\r\n\r\n    isExploded = false;\r\n\r\n    explode() {\r\n        //爆炸 \r\n        this.isExploded = true;\r\n        if (this.bombExplosion) {\r\n            this.getComponent(cc.Sprite).enabled = false;\r\n            this.node_tooltip.active = false;\r\n            this.node_light.active = false;\r\n            if (cc.isValid(this.holder)) {\r\n                this.node.position = this.holder.position;\r\n            }\r\n            this.preExplosion.play(\"pre_explode\")\r\n            // this.bombExplosion.addEventListener(dragonBones.EventObject.COMPLETE, () => {\r\n            //     this.node.destroy();\r\n            // })\r\n        }\r\n    }\r\n\r\n    playSecondExplode() {\r\n        if (!this.onece) return;\r\n        this.onece = false;\r\n        this.bombExplosion.play(\"explode\");\r\n        this.preExplosion.play(\"pre_explode2\")\r\n        Device.playSfx(\"bomb_explode\");\r\n        cc.Camera.main.node.runAction(cc.sequence(Shake.create(0.5, 5, 5), cc.callFunc(this.loseGame, this)));\r\n        evt.emit(\"Game.bomb\");\r\n    }\r\n\r\n    loseGame() {\r\n        this.node && this.node.destroy();\r\n        evt.emit(\"Game.lose\")\r\n    }\r\n\r\n    update() {\r\n\r\n        if (this.body.linearVelocity.y == 0) return;\r\n        this.node.stopAllActions();\r\n    }\r\n}"]}