{"version":3,"sources":["assets\\Game\\Scripts\\OneWayPlatform.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAI,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAA;AAEzC;IAA4C,kCAAY;IAAxD;;IAyDA,CAAC;IAlDG,+BAAM,GAAN;QACI,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC;QAChC,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC;QAC7B,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC;QAC3B,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC;QAC7B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;QAE5C,IAAI,CAAC,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC;IAC5C,CAAC;IAED,8BAAK,GAAL;IAEA,CAAC;IACD,uCAAc,GAAd,UAAe,OAA0B,EAAE,YAAY,EAAE,aAAa;QAElE,IAAI,SAAS,GAAG,aAAa,CAAC,IAAI,CAAC;QACnC,IAAI,YAAY,GAAG,YAAY,CAAC,IAAI,CAAC;QAErC,IAAI,aAAa,GAAG,OAAO,CAAC,gBAAgB,EAAE,CAAC;QAC/C,IAAI,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;QAElC,IAAI,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC;QAC7C,IAAI,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;QACvC,IAAI,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;QACnC,IAAI,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;QAEvC,kDAAkD;QAClD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpC,YAAY,CAAC,+BAA+B,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC;YAC1E,SAAS,CAAC,+BAA+B,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,aAAa,CAAC,CAAC;YACpE,YAAY,CAAC,cAAc,CAAC,aAAa,CAAC,OAAO,CAAC,gBAAgB,CAAC,EAAE,WAAW,CAAC,CAAC;YAElF,IAAI,WAAW,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,gEAAgE;gBACrF,OAAO,CAAE,6DAA6D;iBACrE,IAAI,WAAW,CAAC,CAAC,GAAG,EAAE,EAAE,EAAE,yCAAyC;gBACpE,uDAAuD;gBACvD,YAAY,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,aAAa,CAAC,CAAC;gBACrD,IAAI,aAAa,GAAG,YAAY,CAAC,OAAO,EAAE,CAAC,MAAM,GAAG,CAAC,CAAC,CAAE,uDAAuD;gBAC/G,IAAI,aAAa,CAAC,CAAC,GAAG,aAAa,GAAG,GAAG,GAAG,EAAE;oBAC1C,OAAO,CAAE,0EAA0E;aAC1F;iBACI;gBACD,6BAA6B;aAChC;SACJ;QAED,kCAAkC;QAClC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;IAC5B,CAAC;IAvDgB,cAAc;QADlC,OAAO;OACa,cAAc,CAyDlC;IAAD,qBAAC;CAzDD,AAyDC,CAzD2C,EAAE,CAAC,SAAS,GAyDvD;kBAzDoB,cAAc","file":"","sourceRoot":"/","sourcesContent":["let { ccclass, property } = cc._decorator\r\n@ccclass\r\nexport default class OneWayPlatform extends cc.Component {\r\n    pointVelPlatform: cc.Vec2;\r\n    pointVelOther: cc.Vec2;\r\n    relativeVel: cc.Vec2;\r\n    relativePoint: cc.Vec2;\r\n\r\n    body: cc.RigidBody;\r\n    onLoad() {\r\n        this.pointVelPlatform = cc.v2();\r\n        this.pointVelOther = cc.v2();\r\n        this.relativeVel = cc.v2();\r\n        this.relativePoint = cc.v2();\r\n        this.body = this.getComponent(cc.RigidBody);\r\n\r\n        this.body.enabledContactListener = true;\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n    onBeginContact(contact: cc.PhysicsContact, selfCollider, otherCollider) {\r\n\r\n        let otherBody = otherCollider.body;\r\n        let platformBody = selfCollider.body;\r\n\r\n        let worldManifold = contact.getWorldManifold();\r\n        let points = worldManifold.points;\r\n\r\n        let pointVelPlatform = this.pointVelPlatform;\r\n        let pointVelOther = this.pointVelOther;\r\n        let relativeVel = this.relativeVel;\r\n        let relativePoint = this.relativePoint;\r\n\r\n        //check if contact points are moving into platform\r\n        for (let i = 0; i < points.length; i++) {\r\n            platformBody.getLinearVelocityFromWorldPoint(points[i], pointVelPlatform);\r\n            otherBody.getLinearVelocityFromWorldPoint(points[i], pointVelOther);\r\n            platformBody.getLocalVector(pointVelOther.subSelf(pointVelPlatform), relativeVel);\r\n\r\n            if (relativeVel.y < -32) //if moving down faster than 32 pixel/s (1m/s), handle as before\r\n                return;  //point is moving into platform, leave contact solid and exit\r\n            else if (relativeVel.y < 32) { //if moving slower than 32 pixel/s (1m/s)\r\n                //borderline case, moving only slightly out of platform\r\n                platformBody.getLocalPoint(points[i], relativePoint);\r\n                let platformFaceY = selfCollider.getAABB().height / 2;  //front of platform, should only used on a box collider\r\n                if (relativePoint.y > platformFaceY - 0.1 * 32)\r\n                    return;  //contact point is less than 3.2pixel (10cm) inside front face of platfrom\r\n            }\r\n            else {\r\n                //moving up faster than 1 m/s\r\n            }\r\n        }\r\n\r\n        // store disabled state to contact\r\n        contact.disabled = true;\r\n    }\r\n\r\n}"]}