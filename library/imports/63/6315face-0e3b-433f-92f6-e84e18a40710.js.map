{"version":3,"sources":["assets\\framework\\misc\\Locker.ts"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,IAAM,OAAO,GAAG,EAAE,CAAA;AAClB;IAqBI,gBAAY,MAAM,EAAC,SAAS,EAAC,OAAO;QAFpC,cAAS,GAAW,KAAK,CAAC;QAGtB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;QACnC,IAAI,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE;YACnC,KAAK,EAAC,UAAS,MAAM,EAAC,OAAO,EAAC,aAAa;gBACvC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;gBACtB,IAAG,OAAO,IAAI,MAAM,CAAC,OAAO,EAC5B;oBACI,OAAO,MAAM,CAAC,KAAK,OAAZ,MAAM,kBAAO,IAAI,GAAI,aAAa,GAAC;iBAC7C;YACL,CAAC;SACJ,CAAC,CAAC;QACH,MAAM,CAAC,SAAS,CAAC,GAAG,MAAM,CAAA;QAC1B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,OAAO,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;IAC3B,CAAC;IA9BM,gBAAS,GAAhB,UAAiB,MAAM,EAAC,SAAS;QAE7B,IAAG,OAAO,CAAC,MAAM,CAAC,EAAC;YACf,OAAO,OAAO,CAAC,MAAM,CAAC,CAAA;SACzB;QACD,OAAO,IAAI,MAAM,CAAC,MAAM,EAAC,SAAS,EAAC,MAAM,CAAC,OAAO,CAAC,CAAA;IACtD,CAAC;IA0BD,wBAAO,GAAP;QACI,IAAI;QACJ,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC;QAC7C,IAAG,IAAI,CAAC,SAAS,EAAC;YACd,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;SACpC;QACD,OAAO,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;IAC/B,CAAC;IA3CM,cAAO,GAAG,CAAC,CAAC;IACZ,aAAM,GAAG,CAAC,CAAC;IACX,YAAK,GAAG,CAAC,CAAC;IA0CrB,aAAC;CA9CD,AA8CC,IAAA;kBA9CoB,MAAM","file":"","sourceRoot":"/","sourcesContent":["const lockers = {}\r\nexport default class Locker  {\r\n\r\n    static Prevent = 0;\r\n    static Before = 1;\r\n    static After = 2;\r\n\r\n    static intercept(target,func_name):Locker\r\n    {\r\n        if(lockers[target]){\r\n            return lockers[target]\r\n        }\r\n        return new Locker(target,func_name,Locker.Prevent)\r\n    }\r\n\r\n    func_name:string;\r\n    real_func:Function;\r\n    target:any;\r\n\r\n    agent:Function;\r\n    activated:boolean = false;\r\n\r\n    constructor(target,func_name,options){\r\n        this.func_name = func_name;\r\n        this.real_func = target[func_name];\r\n        var proxy1 = new Proxy(this.real_func, {\r\n            apply:function(target,thisarg,argumentsList){\r\n                this.activated = true;\r\n                if(options != Locker.Prevent)\r\n                {\r\n                    return target.apply(this,...argumentsList)\r\n                }\r\n            }\r\n        });\r\n        target[func_name] = proxy1\r\n        this.target = target;\r\n        lockers[target] = this;\r\n    }\r\n\r\n    release(){\r\n        //还原\r\n        this.target[this.func_name] = this.real_func;\r\n        if(this.activated){\r\n            this.real_func.apply(this.target)\r\n        }\r\n        delete lockers[this.target]\r\n    }\r\n}"]}