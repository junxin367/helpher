{"version":3,"sources":["assets\\Game\\Scripts\\Arrow.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import RemoveOutOfView from \"./RemoveOutOfView\";\r\nimport AIEnemy from \"./AIEnemy\";\r\nimport Role from \"./Role\";\r\nimport Device from \"../../framework/misc/Device\";\r\nimport Target from \"./Target\";\r\nimport Ballon from \"./Ballon\";\r\n\r\nlet { ccclass, property } = cc._decorator\r\n@ccclass\r\nexport default class Arrow extends cc.Component {\r\n    body: cc.RigidBody;\r\n    speed: number = 1500;\r\n\r\n    onLoad() {\r\n        this.body = this.getComponent(cc.RigidBody);\r\n        let check = this.addComponent(RemoveOutOfView);\r\n        check.usingWorldSpace = true;\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    _isMoving = false;\r\n    _vel: cc.Vec2 = cc.v2();\r\n\r\n    go() {\r\n        this._isMoving = true\r\n        let rad = this.node.angle * cc.macro.RAD;\r\n        this._vel = cc.v2(Math.cos(rad), Math.sin(rad));\r\n        this._vel.mulSelf(this.speed);\r\n    }\r\n\r\n    stop() {\r\n        this._isMoving = false;\r\n        this.body.linearVelocity = cc.v2(0, 0);\r\n    }\r\n\r\n    stopWithInetia(scalar = 0.9) {\r\n        this._vel.mulSelf(scalar)\r\n    }\r\n\r\n    update() {\r\n        // velocity\r\n        if (this._isMoving) {\r\n            this.body.linearVelocity = this._vel\r\n        }\r\n    }\r\n\r\n    fadeAfter(delay = 0.5, dur = 0.6) {\r\n        cc.tween(this.node).delay(delay).to(dur, { opacity: 0 }).call(() => this.node.destroy()).start();\r\n    }\r\n\r\n    onBeginContact(contact: cc.PhysicsContact, self, other: cc.PhysicsCollider) {\r\n        console.log(other.name);\r\n        let group = other.node.group;\r\n        if (group == \"wall\" || group == \"pin\") {\r\n            // arrow_hit\r\n            Device.playSfx(\"arrow_hit\")\r\n            this.stop();\r\n            this.fadeAfter()\r\n        } else if (group == 'enemy') {\r\n            //射中敌人\r\n            let enemy = other.getComponent(AIEnemy);\r\n            if (!enemy.isDead()) {\r\n                Device.playSfx(\"arrow_hit_body\")\r\n                enemy.goDead();\r\n            }\r\n        } else if (group == 'role') {\r\n            //射中主角\r\n            let role = other.getComponent(Role);\r\n            Device.playSfx(\"arrow_hit_body\")\r\n            role.goDead();\r\n        } else if (group == 'target') {\r\n            //射中老头\r\n            let target = other.getComponent(Target)\r\n            Device.playSfx(\"arrow_hit_body\")\r\n            this.stopWithInetia(0.1);\r\n            this.schedule(this.stop, 0.3)\r\n            target.goDead();\r\n        } else if (group == 'ballon') {\r\n            let ballon = other.getComponent(Ballon);\r\n            // ballon.flyAway();\r\n            ballon.goDead();\r\n        }\r\n    }\r\n\r\n}"]}