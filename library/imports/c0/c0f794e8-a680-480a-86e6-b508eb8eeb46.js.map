{"version":3,"sources":["assets\\framework\\ui\\ViewManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import View from \"./View\";\r\nimport { evt } from \"../core/event\";\r\nimport Device from \"../misc/Device\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nvar TAG: string = \"[ViewManager]\"\r\n@ccclass\r\nexport default class ViewManager extends cc.Component {\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    static instance: ViewManager;\r\n    // onLoad () {}\r\n\r\n    // baseDir:string = \"assets/\"\r\n\r\n    _views: { [index: string]: View } = {}\r\n\r\n    // \r\n    @property(cc.Node)\r\n    modal: cc.Node = null;\r\n\r\n    @property\r\n    modalOpacity: number = 160;\r\n\r\n    @property(cc.AudioClip)\r\n    audio_show:cc.AudioClip = null;\r\n\r\n    @property(cc.AudioClip)\r\n    audio_hide:cc.AudioClip = null;\r\n\r\n    onLoad() {\r\n        // this.node.zIndex = 1000;\r\n        ViewManager.instance = this;\r\n        this.modal.active = false;\r\n        // this.modal.zIndex = 999;\r\n        // cc.game.addPersistRootNode(this.node);\r\n        // this.node.getComponent(cc.Widget).target = cc.find(\"Canvas\")\r\n        window[\"vm\"] = this;\r\n    }\r\n\r\n    get allViews() {\r\n        return Object.keys(this._views).map(k => this._views[k])\r\n    }\r\n\r\n    onEnable() {\r\n\r\n    }\r\n\r\n    onDestroy() {\r\n        // cc.game.removePersistRootNode(this.node);\r\n        for (var key in this._views) {\r\n            delete this._views[key];\r\n        }\r\n    }\r\n\r\n    start() {\r\n        //load prefab\r\n\r\n        // this.modal.active = false;\r\n        // this.sprite = this.getComponent(cc.Sprite)\r\n        // this.modal.zIndex = 999;\r\n    }\r\n    private getVisibleDialog() {\r\n        let viewStacks = Object.keys(this._views).map(k => this._views[k]).sort((a, b) => b.node.zIndex - a.node.zIndex)\r\n        return viewStacks.find(v => v.isDialog && v.node.active)\r\n        // for (var name in this._views) {\r\n        //     let view = this._views[name]\r\n        //     if (view.isDialog) {\r\n        //         if (this.isVisible(name)) {\r\n        //             return view;\r\n        //         }\r\n        //     }\r\n        // }\r\n        // return null;\r\n    }\r\n\r\n    public hasVisibleDialog() {\r\n        for (var name in this._views) {\r\n            let view = this._views[name]\r\n            if (view.isDialog) {\r\n                if (this.isVisible(name)) {\r\n                    return true\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public isVisible(viewname) {\r\n        let view = null;\r\n        if (typeof (viewname) == \"string\")\r\n            view = this._views[viewname]\r\n        else\r\n            view = viewname;\r\n        //todo check type \r\n        if (view) {\r\n            return view.node.active;\r\n        }\r\n        return false\r\n    }\r\n\r\n    view(name) {\r\n        return this._views[name]\r\n    }\r\n\r\n    private attachViewComp(existingView: cc.Node): View {\r\n        let viewComp = null;\r\n        if (viewComp == null || viewComp == undefined) {\r\n            viewComp = existingView.getComponent(View);\r\n            if (viewComp == null) {\r\n                viewComp = existingView.addComponent(View);\r\n                viewComp.init(existingView.name);\r\n            }\r\n            this._views[viewComp.name] = viewComp;\r\n        }\r\n        return viewComp;\r\n    }\r\n\r\n    private showView(view: View, ...params) {\r\n        this.modal.active = view.isDialog;\r\n        //check has popuped dialog and  all currentview is dialog show modal forcely.\r\n        if (this.hasVisibleDialog() || view.isDialog) {\r\n            this.modal.active = true;\r\n\r\n        }\r\n        if (view.isDialog) {\r\n            this.modal.opacity = view.opacity;\r\n        }\r\n        this.updateZIndex(view);\r\n        this.audio_show && Device.playEffect(this.audio_show);\r\n        return view.show(...params);\r\n    }\r\n\r\n    showFromPrefab(prefab: cc.Prefab, prefabPath: string, ...params) {\r\n        let view = this._views[prefabPath];\r\n        if (view == null) {\r\n            let node = cc.instantiate(prefab)\r\n            if (node == null) {\r\n                throw new Error(\"Error Occurs While Creating View:\" + prefabPath);\r\n            }\r\n            view = node.getComponent(View)\r\n            if (view == null) {\r\n                view = node.addComponent(View);\r\n                view.isDialog = true;\r\n                //default is dialog\r\n            }\r\n            let widget = view.getComponent(cc.Widget);\r\n            if (widget)\r\n                widget.target = cc.find(\"Canvas\")\r\n            view.init(prefabPath);\r\n            this._views[prefabPath] = view;\r\n            if (view.isDialog) {\r\n                this.node.addChild(node, 1000);\r\n            } else {\r\n                this.node.addChild(node, 1000);\r\n            }\r\n        }\r\n        // node = view.node;\r\n        this.node.color.setA(255);\r\n        this.log(TAG, \"show view:\" + prefabPath)\r\n        return this.showView(view, ...params);\r\n    }\r\n\r\n    showFromPrefabPath(prefabPath: string, ...params) {\r\n        let view = this._views[prefabPath]\r\n        if (view == null || view == undefined) {\r\n            this.log(\"start load prefab:\" + prefabPath)\r\n            let beforeTime = new Date().getTime();\r\n            return new Promise<View>((resolve, reject) => {\r\n                cc.resources.load(prefabPath, cc.Prefab, (e, prefab: cc.Prefab) => {\r\n                    this.log(TAG, \"prefab loaded : \" + prefabPath + \" \" + (new Date().getTime() - beforeTime) + \"ms\")\r\n                    this.showFromPrefab(prefab, prefabPath, ...params).then(resolve)\r\n                })\r\n            })\r\n        } else {\r\n            // this.sprite.enabled = false;\r\n            this.modal.active = view.isDialog;\r\n            if (this.hasVisibleDialog() || view.isDialog) {\r\n                this.modal.active = true;\r\n                this.modal.opacity = view.opacity;\r\n            }\r\n            this.log(TAG, \"show view:\" + prefabPath, params)\r\n            this.updateZIndex(view);\r\n            this.audio_show && Device.playEffect(this.audio_show);\r\n            return view.show(...params);\r\n        }\r\n    }\r\n\r\n    preload(prefabPath: string) {\r\n        let view = this._views[prefabPath]\r\n        if (view == null || view == undefined) {\r\n            cc.resources.load(prefabPath, cc.Prefab, (e, prefab: cc.Prefab) => {\r\n                this.log(TAG, \"preload view\" + prefabPath)\r\n                let node = cc.instantiate(prefab)\r\n                view = node.getComponent(View);\r\n                let widget = view.getComponent(cc.Widget);\r\n                if (widget)\r\n                    widget.target = cc.find(\"Canvas\")\r\n                view.init(prefabPath);\r\n                this._views[prefabPath] = view;\r\n                // this.scheduleOnce(_=>node.active = false,0);\r\n                if (view.isDialog) {\r\n                    this.node.addChild(node, 1000);\r\n                } else {\r\n                    this.node.addChild(node, 1000);\r\n                }\r\n                view.hide();\r\n            })\r\n        } else {\r\n        }\r\n    }\r\n\r\n    // will enableTouch next show up\r\n    disableTouch(viewNode) {\r\n        let view = viewNode.getComponent(View)\r\n        if (view) {\r\n            view.touchEnabled = false;\r\n        }\r\n    }\r\n\r\n    enableTouch(viewNode) {\r\n        let view = viewNode.getComponent(View)\r\n        if (view) {\r\n            view.touchEnabled = true;\r\n        }\r\n    }\r\n\r\n\r\n    show(view, ...params) {\r\n        // disable current view 's touch \r\n        let isDialog = false;\r\n        if (view instanceof cc.Component) {\r\n            let v = view.getComponent(View)\r\n            isDialog = v.isDialog;\r\n        }\r\n        // if (isDialog) {\r\n            for (var i = 0; i < this.node.childrenCount; i++) {\r\n                let v = this.node.children[i]\r\n                let view = v.getComponent(View);\r\n                if (view) {\r\n                    if (view.topMost) {\r\n                        v.zIndex = 9999;\r\n                    } else {\r\n                        v.zIndex = i * 2;\r\n                    }\r\n                } else {\r\n                    v.zIndex = i;\r\n                }\r\n            }\r\n        // }\r\n        if (typeof (view) == \"string\") {\r\n            return this.showFromPrefabPath(view, ...params);\r\n        }\r\n        else {\r\n            if (view == null || view == undefined) return;\r\n            if (view.node) view = view.node;\r\n            let v = this.attachViewComp(view)\r\n            return this.showView(v, ...params);\r\n        }\r\n    }\r\n\r\n    updateZIndex(view: View) {\r\n        if (!view.topMost) {\r\n            if (view.isDialog) {\r\n                view.node.zIndex = 1000;\r\n                this.modal.zIndex = 999;\r\n            }\r\n        }\r\n    }\r\n\r\n    hide(viewname, playHideAnim = true) {\r\n        if (typeof (viewname) != \"string\") {\r\n            // get view name \r\n            if (viewname == null || viewname == undefined) return;\r\n            let v = this.attachViewComp(viewname)\r\n            viewname = v.name;\r\n        }\r\n        let view = this._views[viewname]\r\n        if (view != null && view != undefined) {\r\n            if (view.node.active == false) return;\r\n            view.node.active = false;\r\n            if (view.isDialog) {\r\n                //todo: should support dialog hide animtion  later \r\n                this.modal.active = false;\r\n            }\r\n            if (this.hasVisibleDialog()) {\r\n                this.modal.active = true;\r\n            }\r\n            // if(view.isInHideAnimation())\r\n            //     return;\r\n            // view.hide();\r\n            if (playHideAnim)\r\n                view.doHideAnimation();\r\n            view.onHidden();\r\n            this.audio_hide && Device.playEffect(this.audio_hide);\r\n            evt.emit(view.node.name + \".onHidden\")\r\n            evt.emit(\"View.onHidden\", view);\r\n        }\r\n    }\r\n\r\n    checkViewStacks() {\r\n        let dialog = this.getVisibleDialog()\r\n        if (dialog) {\r\n            this.modal.active = true;\r\n            this.modal.opacity = dialog.opacity;\r\n            this.updateZIndex(dialog);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    hideAll() {\r\n        for (var viewname in this._views) {\r\n            // let view = this._views[viewname]\r\n            this.hide(viewname);\r\n        }\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}