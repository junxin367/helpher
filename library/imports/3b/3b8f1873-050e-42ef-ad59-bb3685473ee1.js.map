{"version":3,"sources":["assets\\framework\\misc\\LabelPlayer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property ,menu} = cc._decorator;\r\n\r\n@ccclass\r\n@menu(\"gamelib/LabelPlayer\")\r\nexport default class LabelPlayer extends cc.Component {\r\n\r\n    label: cc.Label = null;\r\n\r\n    @property({slide:true, range:[1,60] ,step:1})\r\n    framePerSec: number = 15;\r\n\r\n    cursor: number = 0;\r\n\r\n    end: number = 0;\r\n\r\n    isLoop: boolean = false;\r\n\r\n    _start: number = 0;\r\n\r\n    isPlaying: boolean = false;\r\n\r\n    @property({ type: [cc.String] })\r\n    animations: string[] = []\r\n\r\n    index2Frames:any[] = [];\r\n\r\n    currentFrames = []\r\n\r\n    @property\r\n    playOnLoad:boolean = false;\r\n\r\n    onLoad() {\r\n        this.label = this.getComponent(cc.Label);\r\n        this.animations.forEach((v,i)=>{\r\n            let [start,end] = v.split(\"-\")\r\n            let frames:number[] = null;\r\n            if(end)\r\n            {\r\n                frames = range(start,end);\r\n            }else{\r\n                frames = v.split(\",\").map(v=>Number(v))\r\n            }\r\n            this.index2Frames.push(frames);\r\n        })\r\n    }\r\n\r\n    get interval()\r\n    {\r\n        return 1/this.framePerSec\r\n    }\r\n\r\n    start() {\r\n        if(this.playOnLoad)\r\n        {\r\n            this.playWithIndex(0,true);\r\n        }\r\n    }\r\n\r\n    private _play(start, end, loop = false) {\r\n        this.isPlaying = true;\r\n        this._start = start;\r\n        this.cursor = start;\r\n        this.end = end;\r\n        this.isLoop = loop;\r\n    }\r\n\r\n    play(start, end, loop = false) {\r\n        let currentFrames = range(start, end)\r\n        this.playArray(currentFrames, loop)\r\n    }\r\n\r\n    playIndexLoop(idx: number) {\r\n        this.playArray(this.index2Frames[idx],true);\r\n    }\r\n\r\n    playIndex(idx: number) {\r\n        this.playArray(this.index2Frames[idx],false);\r\n    }\r\n\r\n\r\n    playWithIndex(idx: number, loop = false) {\r\n        this.playArray(this.index2Frames[idx],loop);\r\n    }\r\n\r\n    setInterval(interval) {\r\n        this.unschedule(this.step)\r\n        this.schedule(this.step, this.interval);\r\n    }\r\n\r\n    playArray(frames: number[], loop: boolean = false) {\r\n        this.currentFrames = frames;\r\n        this._play(0, frames.length - 1,loop)\r\n    }\r\n\r\n    onEnable() {\r\n        this.schedule(this.step, this.interval);\r\n    }\r\n\r\n    onDisable() {\r\n        this.unschedule(this.step);\r\n    }\r\n\r\n    step() {\r\n        if (this.isPlaying) {\r\n            let frame = this.currentFrames[this.cursor]\r\n            this.label.string = frame.toString();\r\n            this.cursor++;\r\n            if (this.cursor > this.end) {\r\n                if (this.isLoop) this.cursor = this._start;\r\n                else this.isPlaying = false;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n}"]}