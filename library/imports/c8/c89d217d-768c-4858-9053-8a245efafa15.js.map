{"version":3,"sources":["assets\\framework\\extension\\mmcloud\\mmgame.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport Platform from \"../Platform\";\nimport { CheatInfo } from \"./cheatInfoDC\";\nimport Cloud from \"./Cloud\";\n\nexport default class mmgame {\n    // not destroy node\n    static comp: cc.Component = null;\n\n    static init(comp: cc.Component) {\n        this.comp = comp;\n    }\n\n    static timer_fake: number = 0;\n\n    /**骗点 \n     * comp  view绑定的脚本\n     * normal 正常的节点\n     * fake 骗点的节点\n     * timeout 真节点出来的延迟时间 \n    */\n    static enableFakeForAdClick(normal: cc.Node, fake: cc.Node, timeout: number, errorCallback?) {\n        try {\n            normal.active = false;\n            fake.active = true;\n            // Platform.hideBannerAd();\n            let scene = cc.director.getScene().name;\n            let recovery = () => {\n                let lastscene = cc.director.getScene().name;\n                if (lastscene == scene) {\n                    console.log(\"*************banner---------5\")\n                    Platform.showBannerAd(errorCallback);\n                    fake.active = false;\n                    normal.active = true;\n                }\n            }\n            // comp.scheduleOnce(recovery, timeout)\n            this.timer_fake = setTimeout(recovery, timeout * 1000);\n            return recovery;\n        } catch (e) {\n            console.warn(e);\n        }\n    }\n\n    static clear() {\n        // comp.unscheduleAllCallbacks();\n        clearTimeout(this.timer_fake);\n    }\n\n    // static scheduleOnce(func, timeout) {\n    //     this.comp.scheduleOnce(func, timeout);\n    // }\n\n\n    // static unschedule(func) {\n    //     this.comp.unschedule(func);\n    // }\n    static getStatus(feature_id: string) {\n        if (Cloud.config.globalSwitch == 0) {\n            return 0;\n        }\n        if (Cloud.funcs == null) {\n            return -1;\n        }\n        let feature = Cloud.funcs[feature_id]\n        if (feature) {\n            return feature.status;\n        } else {\n            return -1;\n        }\n    }\n\n    static isCheatOpen(feature_id: string) {\n        if (Cloud.config.globalSwitch == 0) {\n            return false;\n        }\n        if (Cloud.funcs == null) {\n            return false;\n        }\n        let feature = Cloud.funcs[feature_id]\n        if (!feature) return false;\n        if (feature.status == 1) {\n            let num = parseInt(feature.max);\n            if (!isNaN(num)) {\n                if (CheatInfo.getCount(feature_id) < num) {\n                    // 次数未达最大次数\n                    let rate = parseFloat(feature.ratio);\n                    if (!isNaN(num)) {\n                        if (Math.random() < rate) {\n                            return true\n                        }\n                        console.log(\"[wegame]屏蔽id:\" + feature_id + \"未过概率\")\n                        return false;\n                    } else {\n                        return true;\n                    }\n                }\n                console.log(\"[wegame]屏蔽id:\" + feature_id + \"次数已民达上限\" + CheatInfo.getCount(feature_id))\n                return false\n            } else {\n                return true;\n            }\n        }\n        console.log(\"[wegame]屏蔽id:\" + feature_id + \"未开启\")\n        return false;\n    }\n\n    /**标记已打开 */\n    static markOpen(feature_id) {\n        CheatInfo.markOpen(feature_id)\n    }\n\n    static view_paths: {} = {}\n\n    static registerUI(feature_id, viewpath) {\n        this.view_paths[feature_id] = viewpath;\n    }\n\n    /**打开普通功能（受次数限制)  ，不受屏蔽接口控制 */\n    static openFeature(feature_id, max, data, callback?, target?) {\n        let c = CheatInfo.getCount(feature_id);\n        if (c < max) {\n            let viewpath = this.view_paths[feature_id]\n            if (viewpath) {\n                vm.show(viewpath, data, callback, target);\n            }\n            CheatInfo.markOpen(feature_id);\n            return true\n        }\n        console.log(\"[wegame]打开功能失败: [\" + feature_id + \"]，已超过今天使用次数！(\" + c + \"/\" + max + \")\");\n        return false;\n    }\n\n    static tryOpenFeature(feature_id, max, data) {\n        return new Promise((resolve, reject) => {\n            let b = this.openFeature(feature_id, max, data, resolve)\n            if (!b) {\n                Promise.reject(false);\n            }\n        })\n    }\n\n\n\n    /** 尝试打开屏蔽接口的ui ：红包雨功能 ， 疯狂点击 功能等等 */\n    static openCheat(feature_id, data?, callback?, target?) {\n        if (this.isCheatOpen(feature_id)) {\n            let viewpath = this.view_paths[feature_id]\n            if (viewpath) {\n                vm.show(viewpath, data, callback, target);\n                CheatInfo.markOpen(feature_id);\n                return true;\n            }\n        }\n        console.log(\"[wegame]打开屏蔽功能失败: [\" + feature_id + \"]，未开启，或者超过使用次数，或者概率\")\n        return false;\n    }\n\n    static tryOpenCheat(feature_id, data?, callback?, target?) {\n        return new Promise((resolve, reject) => {\n            let b = this.openCheat(feature_id, data, callback, target)\n            if (!b) {\n                reject(false);\n            } else {\n                resolve(true);\n            }\n        })\n    }\n\n}\nwindow[\"mmgame\"] = mmgame;"]}