{"version":3,"sources":["assets\\framework\\extension\\weak_net_game\\WeakNetGame.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Platform, { ShareInfo } from \"../Platform\";\r\nimport Net, { net } from \"../../misc/Net\";\r\nimport { evt } from \"../../core/event\";\r\nimport { SovInfo } from \"./SovInfo\";\r\nimport gameUtil from \"../../utils/gameUtil\";\r\nimport { Toast } from \"../../ui/ToastManager\";\r\n\r\n\r\n\r\ninterface LoginRet {\r\n    errno: number,\r\n    errmsg: string,\r\n    data: { token: string, openId: string }\r\n}\r\n\r\ninterface ServerConfig {\r\n    share_config_url: string;\r\n    csv_url: string;\r\n    csv: string[];\r\n    local_csv: string[];\r\n}\r\n\r\nexport default class WeakNetGame {\r\n    static serverConfig: WeakNetConf\r\n    static shareConfigs: any = {}\r\n    static config: ServerConfig = { share_config_url: \"share_config.json\", csv_url: \"csv/\", csv: [], local_csv: [] }\r\n    static isInit = false;\r\n    static config_inited = false;\r\n    static shareConfig_inited = false;\r\n    static logined_useId: string = null\r\n\r\n    ///------------------------------------------------------------------\r\n    static video_watched_count = 0;\r\n    static share_fail_count = 0;\r\n    static share_succ_count = 0;\r\n    ///------------------------------------------------------------------\r\n    static is_forbidden = false;\r\n\r\n    /**当天看视频上限 */\r\n    static max_video_watch = 99;\r\n\r\n    static share_succ_delay = 2000;\r\n    /**失败概率 */\r\n    static share_fail_rate = 0.05;\r\n    /**当天分享失败上限 */\r\n    static max_share_fail = 3;\r\n    ///------------------------------------------------------------------\r\n\r\n    static _check_safe_callback: Function = null;\r\n\r\n    /**是否已经登陆 */\r\n    public static get isLoggedIn() {\r\n        return this.logined_useId != null;\r\n    }\r\n\r\n    private static requestConfig() {\r\n        if (this.config_inited) return;\r\n        return new Promise((resolve, reject) => {\r\n            // console.log(\"request url:\", this.serverConfig.config_url)\r\n            net.httpGet(this.serverConfig.config_url + \"?r=\" + Date.now()).then(res => {\r\n                if (res == Net.Code.Timeout) {\r\n                    reject('timeout')\r\n                } else {\r\n                    if (res) {\r\n                        this.config = JSON.parse(res)\r\n                        this.config_inited = true;\r\n                        console.log('配置', this.config);\r\n                        resolve();\r\n                    }\r\n                    else {\r\n                        resolve();\r\n                    }\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    //share_config_url\r\n    private static requestShareConfig() {\r\n        if (this.shareConfig_inited) return;\r\n        return new Promise((resolve, reject) => {\r\n            net.httpGet(this.serverConfig.cdn_url + this.config.share_config_url + \"?t=\" + Date.now()).then(res => {\r\n                if (res == Net.Code.Timeout) {\r\n                    resolve();\r\n                } else {\r\n                    if (res) {\r\n                        this.shareConfigs = JSON.parse(res)\r\n                        this.shareConfig_inited = true;\r\n                        console.log('分享配置', this.shareConfigs)\r\n                        resolve();\r\n                    } else {\r\n                        resolve();\r\n                    }\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    static _configstr_cache: { [index: string]: { timestamp, data } } = {}\r\n\r\n    //csv_url\r\n    public static downloadCsv(name) {\r\n        //5秒以内无需下载 \r\n        let time = Date.now()\r\n        let cache = this._configstr_cache[name]\r\n        if (cache && time - cache.timestamp <= 1000 * 10) {\r\n            console.log(\"刚已下载并加载表： \" + name)\r\n            return Promise.resolve()\r\n        }\r\n        let url = this.serverConfig.cdn_url + this.config.csv_url + name + '.csv' + \"?t=\" + Date.now()\r\n        return new Promise((resolve, reject) => {\r\n            console.log(\"download csv:\" + name)\r\n            net.httpGet(url).then(res => {\r\n                if (res == Net.Code.Timeout) {\r\n                    csv.load(\"Config/csv/\" + name, resolve);\r\n                } else {\r\n                    if (res) {\r\n                        csv.loadString(name, res, resolve)\r\n                        delete this._configstr_cache[name];\r\n                        this._configstr_cache[name] = { timestamp: Date.now(), data: res };\r\n                    } else {\r\n                        csv.load(\"Config/csv/\" + name, resolve);\r\n                    }\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    public static loadLocalCsv(name, callback) {\r\n        return new Promise((resolve, reject) => {\r\n            console.log(\"load local csv:\" + name);\r\n            csv.load(\"Config/csv/\" + name, resolve);\r\n            if (callback) callback(name);\r\n        })\r\n    }\r\n\r\n    private static loadLocalCsvs(callback) {\r\n        if (this.config.local_csv == null) {\r\n            return new Promise(resolve => {\r\n                csv.loadDir(\"Config/csv\", resolve)\r\n            })\r\n        } else {\r\n            if (this.config.local_csv.length > 0) {\r\n                let arr = []\r\n                this.config.local_csv.forEach(v => {\r\n                    let p = this.loadLocalCsv(v, callback)\r\n                    arr.push(p)\r\n                })\r\n                return Promise.all(arr);\r\n            }\r\n        }\r\n    }\r\n\r\n    private static downloadCsvs() {\r\n        if (this.config.csv.length == 0) {\r\n            csv.loadDir(\"Config/csv\")\r\n        } else {\r\n            let arr = []\r\n            this.config.csv.forEach(v => {\r\n                let p = this.downloadCsv(v);\r\n                arr.push(p);\r\n            })\r\n            return Promise.all(arr);\r\n        }\r\n    }\r\n\r\n    static client = new Net();\r\n\r\n    static retry_count = 0;\r\n\r\n    static userInfo: any = null;\r\n\r\n    static async login() {\r\n        let params: any = { openId: this.serverConfig.openId }\r\n        if (CC_WECHATGAME) {\r\n            Platform.login()\r\n            let [code] = await evt.wait(\"wxlogin\")\r\n            let options = wx.getLaunchOptionsSync();\r\n            params = {\r\n                code,\r\n                type: \"wxlogin\",\r\n                query: JSON.stringify(options.query),\r\n                scene: options.scene\r\n            }\r\n        }\r\n        let res = await this.client.httpGet(this.serverConfig.root_url + \"/game/login\", params)\r\n        if (res == Net.Code.Timeout) {\r\n            console.log(\"登陆失败\", this.retry_count)\r\n            return false;\r\n        } else {\r\n            if (res) {\r\n                let ret = JSON.parse(res) as LoginRet;\r\n                console.log(\"登陆返回\", ret);\r\n                if (ret.data) {\r\n                    this.client.setHeader(\"Authorization\", ret.data.token);\r\n                    console.log('登陆成功', ret.data);\r\n                    this.logined_useId = ret.data.openId;\r\n                    this.retry_count = 0;\r\n                    this.userInfo = ret.data;\r\n                    return true;\r\n                }\r\n                console.log(\"登陆失败\")\r\n                return false;\r\n            }\r\n            else {\r\n                console.log(\"登陆失败\", this.retry_count)\r\n                return false;\r\n                //重新登陆 \r\n                // if (this.retry_count <= 1) {\r\n                //     this.retry_count++;\r\n                //     return await this.login();\r\n                // } else {\r\n                //     return false;\r\n                // }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n    static async syncData(v, openId?) {\r\n        if (openId == null) {\r\n            if (WeakNetGame.isLoggedIn) {\r\n                openId = this.logined_useId;\r\n            } else {\r\n                return console.warn(\"上传数据！，未登陆且未指定用户id\")\r\n            }\r\n        }\r\n        return this.syncDataToTable(v, 'user', openId);\r\n    }\r\n\r\n    /**\r\n     * 上传数据到指定远端服务器 \r\n     * @param v 数据 \r\n     * @param table  指定表\r\n     * @param id  数据id \r\n     */\r\n    static async syncDataToTable(v, table, id?) {\r\n        if (id == null) {\r\n            return console.warn(\"上传数据！未指定id !\")\r\n        }\r\n        let res = await this.client.httpPut(this.serverConfig.root_url + \"/\" + table + \"/\" + id, v)\r\n        if (res == Net.Code.Timeout) {\r\n            console.log(\"上传数据 超时....\")\r\n            return false\r\n        } else {\r\n            if (res) {\r\n                let ret = JSON.parse(res);\r\n                console.log(ret);\r\n                return ret;\r\n            } else {\r\n                console.warn(\"同步数据失败\")\r\n                return false\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    static async loadUserInfo() {\r\n        //拉取用户数据\r\n        if (!this.isLoggedIn) return console.warn(\"拉取数据时：未登录\");\r\n        if (this.userInfo) {\r\n            return this.userInfo\r\n        }\r\n        console.log(\"拉取用户数据\")\r\n        let res = await this.client.httpGet(this.serverConfig.root_url + \"/user/\" + this.logined_useId)\r\n        if (res == Net.Code.Timeout) {\r\n            return this.userInfo;\r\n        } else {\r\n            if (res) {\r\n                let ret = JSON.parse(res);\r\n                if (!ret.errno) {\r\n                    return ret.data;\r\n                }\r\n            }\r\n            else {\r\n                return this.userInfo;\r\n            }\r\n        }\r\n    }\r\n\r\n    static setVideoWatchedCount(c) {\r\n        this.video_watched_count = c;\r\n        localStorage.setItem(\"__video_watched_count__\", this.video_watched_count + \"\")\r\n        localStorage.setItem(\"__video_watched_date__\", Date.now().toString())\r\n    }\r\n\r\n\r\n    static setShareFailCount(c) {\r\n        this.share_fail_count = c;\r\n        localStorage.setItem(\"_share_fail_count_\", this.share_fail_count + \"\")\r\n        localStorage.setItem(\"_share_fail_date_\", Date.now().toString())\r\n    }\r\n\r\n\r\n    static setShareSuccCount(c) {\r\n        this.share_succ_count = c;\r\n        localStorage.setItem(\"_share_succ_count_\", this.share_succ_count + \"\")\r\n        localStorage.setItem(\"_share_succ_date_\", Date.now().toString())\r\n    }\r\n\r\n    static initUserData() {\r\n        let video_watched_count = localStorage.getItem('__video_watched_count__')\r\n        let video_watched_date = localStorage.getItem(\"__video_watched_date__\")\r\n        let fail_share_count = localStorage.getItem('_share_fail_count_')\r\n        let fail_share_date = localStorage.getItem(\"_share_fail_date_\")\r\n\r\n        let succ_share_count = localStorage.getItem('_share_succ_count_')\r\n        let succ_share_date = localStorage.getItem(\"_share_succ_date_\")\r\n\r\n        let d = parseInt(video_watched_date)\r\n        let c = parseInt(video_watched_count)\r\n        if (isNaN(c)) {\r\n            this.setVideoWatchedCount(0)\r\n        } else {\r\n            this.video_watched_count = c\r\n        }\r\n        if (!isNaN(d)) {\r\n            if (gameUtil.isNextDay(d)) {\r\n                this.setVideoWatchedCount(0)\r\n            }\r\n        }\r\n\r\n        d = parseInt(fail_share_date)\r\n        c = parseInt(fail_share_count)\r\n        if (isNaN(c)) {\r\n            this.setShareFailCount(0)\r\n        } else {\r\n            this.share_fail_count = c\r\n        }\r\n        if (!isNaN(d)) {\r\n            if (gameUtil.isNextDay(d)) {\r\n                this.setShareFailCount(0)\r\n            }\r\n        }\r\n\r\n        d = parseInt(succ_share_count)\r\n        c = parseInt(succ_share_date)\r\n        if (isNaN(c)) {\r\n            this.setShareSuccCount(0)\r\n        } else {\r\n            this.share_succ_count = c\r\n        }\r\n        if (!isNaN(d)) {\r\n            if (gameUtil.isNextDay(d)) {\r\n                this.setShareSuccCount(0)\r\n            }\r\n        }\r\n    }\r\n\r\n    static initConfig(conf) {\r\n        this.serverConfig = conf;\r\n        this.client.setTimeout(2500)\r\n        console.log(\"[WeakNetGame]加载配置文件\")\r\n        console.log(conf);\r\n    }\r\n\r\n    static async doLogin(progressCallback?): Promise<any> {\r\n        if (!this.isInit) {\r\n            console.log(\"[WeakNetGame]开始登陆\")\r\n            WeakNetGame.initUserData()\r\n            if (!this.serverConfig.is_local_game) {\r\n                progressCallback && progressCallback(\"config\");\r\n                await WeakNetGame.requestConfig()\r\n                progressCallback && progressCallback(\"local_csv\");\r\n                await WeakNetGame.loadLocalCsvs(_ => {\r\n                    // progressCallback && progressCallback('local_csv_loaded', _);\r\n                })\r\n                progressCallback && progressCallback(\"csv\");\r\n                await WeakNetGame.downloadCsvs()\r\n\r\n                if (this.serverConfig.is_normal_login) {\r\n                    progressCallback && progressCallback(\"login\");\r\n                    await WeakNetGame.login()\r\n                }\r\n                if (CC_WECHATGAME) {\r\n                    progressCallback && progressCallback(\"share_config\");\r\n                    await WeakNetGame.requestShareConfig();\r\n                    Platform.initShare(this.shareConfigs['default'], this.logined_useId)\r\n                }\r\n                //检测 ip \r\n                if (!this.isLoggedIn) {\r\n                    return false;\r\n                }\r\n                this.isInit = true;\r\n                progressCallback && progressCallback(\"complete\");\r\n                return await WeakNetGame.loadUserInfo()\r\n            } else {\r\n                this.isInit = true;\r\n                return new Promise(resolve => {\r\n                    csv.loadDir(\"Config/csv\", resolve)\r\n                })\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 视频v次后分享s次，然后循环；\r\n     * @param a  当前执行了几次\r\n     * @param v  视频v次\r\n     * @param s  分享s次\r\n     */\r\n    static check(a, t1, c1, t2, c2) {\r\n        let c = c1 + c2 + 1;\r\n        a = a % c;\r\n        if (a >= c1) return t2;\r\n        else if (a <= c1) return t1;\r\n    }\r\n\r\n    static getChoice(key) {\r\n        if (this.video_watched_count >= this.max_video_watch) {\r\n            return 0;\r\n        }\r\n        let val = key\r\n        if (typeof (key) == \"string\") {\r\n            if (csv.Config) {\r\n                val = csv.Config[key];\r\n            } else {\r\n                val = 0;\r\n            }\r\n        }\r\n        let choice = Number(val)\r\n        if (isNaN(choice)) {\r\n            // 0=3,1=4 \r\n            try {\r\n                let [[t1, c1], [t2, c2]] = val.split(\",\").map(v => v.split(\"=\").map(x => parseInt(x)))\r\n                let c = SovInfo.getCount(key)\r\n                choice = this.check(c, t1, c1, t2, c2)\r\n            } catch (e) {\r\n                console.error(\"配置错误：请检测后台配置！\" + \"[\" + key + \"] = \" + val);\r\n                choice = 0;\r\n            }\r\n        }\r\n        if (val == 2) {\r\n            choice = g.randomInt(0, 2);\r\n        }\r\n        return choice;\r\n    }\r\n\r\n    static set_safe_check_callback(callback) {\r\n        this._check_safe_callback = callback\r\n    }\r\n\r\n    static get is_safe_mode() {\r\n        if (!this._check_safe_callback) return false;\r\n        return this._check_safe_callback();\r\n    }\r\n\r\n    /**只保存当前session */\r\n    private static _sharedUUIDs = {}\r\n\r\n    static get sharedUUIDs() {\r\n        return this._sharedUUIDs;\r\n    }\r\n\r\n    static isValidShare(uuid) {\r\n        return this._sharedUUIDs[uuid] != null;\r\n    }\r\n\r\n    private static claimedUUIDs = {}\r\n\r\n    static isClaimedShare(uuid: string) {\r\n        return this.claimedUUIDs[uuid] != null\r\n    }\r\n\r\n    static claimShare(uuid: string) {\r\n        this.claimedUUIDs[uuid] = uuid;\r\n        let callback = this._sharedUUIDs[uuid]\r\n        if (callback)\r\n            callback()\r\n    }\r\n\r\n    static share_fail_texts = ['分享失败，请分享到30人群', '分享失败，请分享到新的群']\r\n\r\n    static doChoice(key: any, callback, target?, fail_callback?) {\r\n        let choice = this.getChoice(key);\r\n        //发送给指定好友\r\n        //https://developers.weixin.qq.com/minigame/dev/api/open-api/data/wx.shareMessageToFriend.html\r\n        let shareToFriend = () => {\r\n            // let shareCfg = this.shareConfigs['default'] as ShareInfo\r\n            // let imageUrl = shareCfg.imageUrl;\r\n            // let imageUrlId = \"\";//?审核通过的图片 ID，详见https://developers.weixin.qq.com/minigame/dev/guide/open-ability/share/share.html#%E4%BD%BF%E7%94%A8%E5%AE%A1%E6%A0%B8%E9%80%9A%E8%BF%87%E7%9A%84%E8%BD%AC%E5%8F%91%E5%9B%BE%E7%89%87\r\n            // Platform.sendMessageToOpen(\"shareMessageToFriend\", { imageUrl, imageUrlId })\r\n            // evt.emit(\"wx.shareMessageToFriend\", function() {});if\r\n            // 2. 当玩家当日普通分享获利超过3次后，给出toast提示：暂无可用视频，请稍后再试~；\r\n            if (this.share_succ_count >= 3) {\r\n                Toast.make(\"暂无可用视频，请稍后再试 !\")\r\n                fail_callback && fail_callback.call();\r\n            } else {\r\n                share();\r\n            }\r\n\r\n        }\r\n        let watch = () => {\r\n            Platform.watch_video(_ => {\r\n                SovInfo.invoke(key);\r\n                this.video_watched_count++\r\n                this.setVideoWatchedCount(this.video_watched_count)\r\n                evt.emit(\"WeakNetGame.watch_video\", this.video_watched_count)\r\n                callback && callback.call(target, 'video')\r\n\r\n            }, target, () => {\r\n                // 1. 当获利点不能正常拉起视频时，需要切换到普通分享；\r\n                shareToFriend();\r\n            })\r\n        }\r\n        let share = (b = false) => {\r\n\r\n            if (this.is_safe_mode) {\r\n                watch()\r\n                return;\r\n            }\r\n            if (this.is_forbidden) {\r\n                watch()\r\n            } else {\r\n                if (b) {\r\n                    let uuid = g.uuid(8, 16)\r\n                    this._sharedUUIDs[uuid] = callback.bind(target, 'share_link_click');\r\n                    Platform.doShareWithParams({ uuid, share_link: true }, this.shareConfigs[key], () => {\r\n                        callback && callback.call(target, 'share_link');\r\n                    }, this);\r\n                } else {\r\n                    //6. 连续分享失败3次后，第4次点击去分享按钮，直接拉起视频；\r\n                    // if (this.share_fail_count >= 3) {\r\n                    //     this.setShareFailCount(0)\r\n                    //     return watch();\r\n                    // }\r\n                    Platform.doShare(this.shareConfigs[key], (ok) => {\r\n                        let notFail = true;\r\n                        if (CC_WECHATGAME) {\r\n                            if (Math.random() < this.share_fail_rate) {\r\n                                notFail = false;\r\n                            }\r\n                        }\r\n                        if (ok && notFail) {\r\n                            this.setShareSuccCount(++this.share_succ_count)\r\n                            evt.emit(\"WeakNetGame.ShareSuccess\", key)\r\n                            callback && callback.call(target, 'share');\r\n                            SovInfo.invoke(key);\r\n                        } else {\r\n                            this.setShareFailCount(++this.share_fail_count)\r\n                            fail_callback && fail_callback.call();\r\n                            evt.emit(\"WeakNetGame.ShareFail\", key)\r\n                            if (CC_WECHATGAME) {\r\n                                wx.showModal({\r\n                                    title: \"提示\",\r\n                                    content: g.getRandom(this.share_fail_texts),\r\n                                    showCancel: true,\r\n                                    cancelText: \"取消\",\r\n                                    confirmText: \"去分享\",\r\n                                    success: (res) => {\r\n                                        if (res.cancel) {\r\n                                            //点击取消,默认隐藏弹框\r\n                                        } else {\r\n                                            share();\r\n                                        }\r\n                                    }\r\n                                })\r\n                            } else {\r\n                                console.warn(\"分享失败! ,请重试!\")\r\n                            }\r\n                        }\r\n                    }, this.share_succ_delay)\r\n                }\r\n            }\r\n        }\r\n        if (choice == 0) {\r\n            share()\r\n        } else if (choice == 1) {\r\n            if (this.video_watched_count >= this.max_video_watch) {\r\n                share();\r\n            } else {\r\n                watch();\r\n            }\r\n        } else if (choice == 3) {\r\n            callback && callback.call(target)\r\n        } else if (choice == 4) {\r\n            // 链接分享 ，需要玩家点击链接后完成整个分享流程\r\n            share(true);\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nwindow[\"WeakNetGame\"] = WeakNetGame;"]}