{"version":3,"sources":["assets\\framework\\ui\\game\\SubpackageLoader.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Signal from \"../../core/Signal\";\r\nimport Platform from \"../../extension/Platform\";\r\n\r\nlet { ccclass, property } = cc._decorator\r\n@ccclass\r\nexport default class SubpackageLoader extends cc.Component {\r\n    @property(cc.Label)\r\n    label_progress: cc.Label = null;\r\n\r\n    @property(cc.ProgressBar)\r\n    bar: cc.ProgressBar = null\r\n\r\n    @property(cc.Label)\r\n    label: cc.Label = null;\r\n\r\n    @property(cc.Button)\r\n    btn_retry: cc.Button = null;\r\n\r\n\r\n    @property(cc.Button)\r\n    btn_close: cc.Button = null;\r\n\r\n    onLoad() {\r\n        this.btn_retry.node.on(cc.Node.EventType.TOUCH_END, this.click_retry, this);\r\n        if (this.btn_close)\r\n            this.btn_close.node.on(cc.Node.EventType.TOUCH_END, this.click_close, this);\r\n    }\r\n\r\n    onSuccess: Signal = new Signal();\r\n    names: string[] = []\r\n\r\n    hideOnFinish: boolean = true;\r\n\r\n    onShown(names: any, hideOnFinish, callback, target) {\r\n        this.hideOnFinish = hideOnFinish;\r\n        this.onSuccess.clear();\r\n        this.onSuccess.on(callback, target);\r\n        this.names.splice(0);\r\n        if (Array.isArray(names)) {\r\n            this.names = names;\r\n        } else if (typeof (names) == \"string\") {\r\n            this.names.push(names);\r\n        } else {\r\n            console.error(\"[SubpackageLoader] fail to load : params error\")\r\n            return;\r\n        }\r\n        this.startLoad();\r\n    }\r\n\r\n    /**\r\n     * 显示 当前下载 进度\r\n     * @param name 子包名\r\n     * @param percent  当前进度 x/100\r\n     * @param c 下载字节数\r\n     * @param t 总下载字节数 \r\n     */\r\n    showStatus(name, percent, c, t) {\r\n        if (this.label_progress)\r\n            this.label_progress.string = percent + \"%\"\r\n        if (this.bar)\r\n            this.bar.progress = percent / 100;\r\n        if (this.label)\r\n            this.label.string = \"加载[\" + name + \"]中\"\r\n    }\r\n\r\n    async startLoad() {\r\n        this.btn_retry.node.active = false;\r\n        this.btn_close.node.active = false;\r\n        try {\r\n            for (var i = 0; i < this.names.length; i++) {\r\n                let name = this.names[i];\r\n                await Platform.loadSubPackage(name, (p, c, t) => {\r\n                    this.showStatus(name, p, c, t);\r\n                })\r\n            }\r\n            this.onSuccess.fire(this);\r\n            if (this.hideOnFinish) {\r\n                vm.hide(this);\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            if (this.label)\r\n                this.label.string = \"加载失败,请点击重试!\"\r\n            this.btn_retry.node.active = true;\r\n            this.btn_close.node.active = true;\r\n        }\r\n    }\r\n\r\n    cancel() {\r\n        this.onSuccess.clear()\r\n        vm.hide(this);\r\n    }\r\n\r\n    click_close() {\r\n        vm.hide(this);\r\n    }\r\n\r\n    onHidden() {\r\n        this.cancel()\r\n    }\r\n\r\n    click_retry() {\r\n        this.btn_retry.node.active = false;\r\n    }\r\n}"]}