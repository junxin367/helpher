{"version":3,"sources":["assets\\Game\\Scripts\\UI\\UISkin.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\n\nimport mvcView from \"../../../framework/ui/mvcView\";\nimport ccUtil from \"../../../framework/utils/ccUtil\";\nimport { evt } from \"../../../framework/core/event\";\nimport { PlayerInfo } from \"../Common/Base/PlayerInfo\";\nimport { Toast } from \"../../../framework/ui/ToastManager\";\nimport { UserInfo } from \"../../../framework/extension/weak_net_game/UserInfo\";\nimport Platform from \"../../../framework/extension/Platform\";\n\nconst { ccclass, property } = cc._decorator;\n\nenum TabType {\n    Female = 1,\n    Male,\n    Theme,\n}\n\nexport enum SkinType {\n    Hair = 0,\n    Hat = 1,\n    Up,\n    Down,\n    Misc,\n    Theme,\n    Key\n}\n\nlet SkinTypeProp = {\n    [SkinType.Hair]: { name: \"头发\", color: \"#FA8F4A\" },\n    [SkinType.Hat]: { name: \"帽子\", color: \"#FA8F4A\" },\n    [SkinType.Up]: { name: \"上身\", color: \"#FA8F4A\" },\n    [SkinType.Down]: { name: \"下身\", color: \"#FA8F4A\" },\n    [SkinType.Misc]: { name: \"附件\", color: \"#00D893\" },\n    [SkinType.Theme]: { name: \"主题背景\", color: \"#0B88FF\" },\n    [SkinType.Key]: { name: \"钥匙\", color: \"#00D893\" },\n}\n\n@ccclass\nexport default class UISkin extends mvcView {\n\n    @property(cc.Layout)\n    layout: cc.Layout = null;\n\n    @property(cc.Node)\n    titleNode: cc.Node = null;\n\n    @property(cc.Layout)\n    listLayout: cc.Layout = null;\n\n\n    @property(cc.Label)\n    label_star_free: cc.Label = null;\n\n    // layouts: cc.Layout = null\n\n    private _tab: number = 2;\n    public get tabIndex(): number {\n        return this._tab;\n    }\n    public set tabIndex(value: number) {\n        if (value == -1) {\n            value = TabType.Theme;\n        }\n        if (this._tab != value) {\n            this._tab = value;\n            this.selectTab(value)\n        }\n    }\n\n    tabs_loaded: [] = [];\n\n\n    //@ts-ignore\n    all_cls: { [index: number]: { title: cc.Node, content: cc.Node } } = {};\n\n    _first = true;\n\n\n    onLoad() {\n        this.register(this.label_star_free, () => \"获取\" + csv.Config.skin_store_free_star)\n        this.loadTab();\n        this._tab = 3;\n        this.updateTab(this._tab);\n        evt.on(\"Skin.select\", this.onSelect, this)\n        Platform.hideBannerAd();\n    }\n\n    onDestroy() {\n        evt.off(\"Skin.select\", this.onSelect, this)\n    }\n\n\n    onSelect(data: csv.Skin_Row) {\n        //refresh other \n        let node = this.all_cls[data.subType].content;\n        let list = node.getComponent(cc.Layout);\n        this.renderLayout(list)\n        Toast.make(\"已选择:\" + data.name)\n        if (data.subType == SkinType.Theme) {\n            UserInfo.theme = data.data;\n        } else if (data.subType == SkinType.Key) {\n            UserInfo.theme_key = data.data;\n        }\n        UserInfo.save('theme');\n        UserInfo.save('theme_key');\n    }\n\n    loadTab() {\n        for (let i = 0; i <= SkinType.Key; i++) {\n            this.initClass(i);\n        }\n        this.titleNode.active = false;\n        this.listLayout.node.active = false;\n    }\n\n    selectTab(index) {\n        this.tabIndex = index;\n        this.updateTab(index)\n    }\n\n    enableCls(...clsTypes) {\n        for (let k in this.all_cls) {\n            let tk = parseInt(k);\n            let tv = this.all_cls[k];\n            let b = clsTypes.indexOf(tk) >= 0;\n            tv.title.active = b;\n            tv.content.active = b;\n        }\n    }\n\n    updateTab(index) {\n        if (index == TabType.Theme) {\n            this.enableCls(SkinType.Theme, SkinType.Key)\n            // } else if (index == TabType.Male) {\n            //     this.enableCls(SkinType.Hair, SkinType.Up, SkinType.Down, SkinType.Misc)\n        } else {\n            this.enableCls(SkinType.Hair, SkinType.Hat, SkinType.Up, SkinType.Down, SkinType.Misc)\n        }\n        if (this._first == true) {\n            this._first = false;\n            return;\n        }\n        this.render();\n    }\n\n    //\n    initClass(type) {\n        let cfg = SkinTypeProp[type];\n        let node = cc.instantiate(this.titleNode)\n        this.layout.node.addChild(node);\n        let label = ccUtil.find(\"label\", node, cc.Label)\n        label.string = cfg.name;\n        if (cfg.color) {\n            node.color = new cc.Color().fromHEX(cfg.color)\n        }\n        let list = cc.instantiate(this.listLayout.node)\n        this.layout.node.addChild(list);\n        let layout = list.getComponent(cc.Layout);\n\n        this.register(layout, this.skinsForType.bind(this, type));\n        this.all_cls[type] = ({ title: node, content: list })\n    }\n\n    skinsForType(type) {\n        let skins = csv.Skin.search((v, i) => {\n            return v.type == this.tabIndex && v.subType == type;\n        })\n        return skins;\n    }\n\n    onToggle(toggle: cc.Toggle, index) {\n        this.tabIndex = parseInt(index);\n    }\n\n    // skinItemAtIndex(node: cc.Node, data: csv.Skin_Row, i) {\n    //     // node.getComponent(UISKInItem).render()\n    // }\n\n    onShow() {\n        evt.emit('UISkin.checkLock');\n        this.render();\n    }\n\n    click_close() {\n        vm.hide(this);\n        //save somtthing\n    }\n\n    click_getstar() {\n        Platform.watch_video(this.video_callback, this)\n    }\n\n    video_callback() {\n        PlayerInfo.star += csv.Config.skin_store_free_star || 3;\n        PlayerInfo.save('star');\n    }\n\n}\n"]}