{"version":3,"sources":["assets\\framework\\extension\\movement\\Bounce.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Signal from \"../../../framework/core/Signal\";\r\n\r\nlet { ccclass, property } = cc._decorator\r\n\r\nconst s_maxBounces: number = 3;\r\nconst s_gravity: number = 100;\r\nconst s_frictionFactorY: number = 0.1;\r\nconst s_frictionFactorX: number = 0.5;\r\nconst s_bounceFactor: number = 0.4;\r\n@ccclass\r\nexport default class Bounce extends cc.Component {\r\n\r\n    private m_bounces: number = 0;\r\n\r\n    private m_coinVerticalVelocity: number = 0;\r\n\r\n    m_vel: cc.Vec2 = cc.v2(0, 0);\r\n\r\n    timeout: number = 0;\r\n\r\n    onFinish: Signal = new Signal();\r\n    onBounce: Signal = new Signal();\r\n\r\n    once = true;\r\n\r\n    bRotate: boolean = false;\r\n\r\n    onLoad() {\r\n\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    onEnable() {\r\n        this.once = true;\r\n        this.m_bounces = 0;\r\n        this.m_coinVerticalVelocity = 0;\r\n        this.m_vel.mulSelf(0);\r\n    }\r\n\r\n    bounceBaseY: number = 0;\r\n\r\n    go(x, y, bounceBaseY) {\r\n        this.m_vel.x = x;\r\n        this.m_vel.y = y;\r\n        this.bounceBaseY = bounceBaseY;\r\n    }\r\n\r\n    update(dt) {\r\n        if (this.m_bounces < s_maxBounces) {\r\n            if (this.node.y < this.bounceBaseY) {\r\n                this.m_bounces++;\r\n                //bounce \r\n                this.m_coinVerticalVelocity = this.m_coinVerticalVelocity * (-s_bounceFactor);\r\n                this.node.y = this.bounceBaseY;\r\n                // damping \r\n                this.m_vel.x = this.m_vel.x * s_frictionFactorX;\r\n                this.m_vel.y = this.m_vel.y * s_frictionFactorY;\r\n                if (this.bRotate)\r\n                    this.node.angle += 60;\r\n                this.onBounce.fire(this);\r\n            }\r\n            this.node.x += this.m_vel.x;\r\n            this.node.y += this.m_vel.y;\r\n\r\n            this.m_coinVerticalVelocity = this.m_coinVerticalVelocity + s_gravity * dt;\r\n            //fall \r\n            // this.m_coinHeight = this.m_coinHeight - this.m_coinVerticalVelocity;\r\n            this.node.y -= this.m_coinVerticalVelocity;\r\n        } else {\r\n            if (this.once) {\r\n                this.once = false;\r\n                if (this.timeout > 0) {\r\n                    this.scheduleOnce(this.emitFinish, this.timeout)\r\n                } else {\r\n                    this.emitFinish();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    emitFinish() {\r\n        try {\r\n            this.onFinish.fire(this);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n}"]}