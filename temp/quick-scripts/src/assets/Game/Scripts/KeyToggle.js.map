{"version":3,"sources":["assets\\Game\\Scripts\\KeyToggle.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { evt } from \"../../framework/core/event\";\r\nimport ccUtil from \"../../framework/utils/ccUtil\";\r\nimport Device from \"../../framework/misc/Device\";\r\nimport { SettingInfo } from \"../../framework/extension/weak_net_game/SettingInfo\";\r\nimport Signal from \"../../framework/core/Signal\";\r\nimport { PlayerInfo } from \"./Common/Base/PlayerInfo\";\r\nimport { UserInfo } from \"../../framework/extension/weak_net_game/UserInfo\";\r\nimport Game from \"./Game\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nexport enum KeyDir {\r\n    Left_To_Right,\r\n    Right_To_Left,\r\n    Top_To_Bottom,\r\n    Bottom_To_Top,\r\n}\r\n\r\nexport enum KeyShape {\r\n    UNKNOWN,\r\n    H,\r\n    V,\r\n    DOOR,\r\n    LEFTDOOR,\r\n    RIGHTDOOR\r\n}\r\n\r\n@ccclass\r\nexport default class KeyToggle extends cc.Component {\r\n\r\n    @property(cc.PrismaticJoint)\r\n    joint: cc.PrismaticJoint = null;\r\n\r\n    @property({ type: cc.Enum(KeyDir), displayName: \"移动方向\" })\r\n    keyDir: KeyDir = KeyDir.Bottom_To_Top;\r\n\r\n\r\n    @property({ type: cc.Enum(KeyShape), displayName: \"水平/垂直\" })\r\n    shape: KeyShape = KeyShape.UNKNOWN;\r\n\r\n    originPos: cc.Vec3 = cc.v3();\r\n    openPos: cc.Vec3 = cc.v3();\r\n\r\n    @property(cc.RigidBody)\r\n    body: cc.RigidBody = null;\r\n\r\n    @property(cc.Node)\r\n    handler: cc.Node = null;\r\n\r\n    collider: cc.PhysicsCollider = null;\r\n\r\n    @property({ displayName: \"增强热区\" })\r\n    strongArea: boolean = false;\r\n\r\n    onToggleSwitched: Signal = new Signal();\r\n\r\n\r\n    stopSign: cc.Node = null;\r\n\r\n    onLoad() {\r\n        if (this.joint == null) {\r\n            this.joint = this.node.getComponentInChildren(cc.PrismaticJoint);\r\n        }\r\n        this.body = this.getComponent(cc.RigidBody)\r\n        this.body.type = cc.RigidBodyType.Static\r\n\r\n        this.originPos = this.node.position;\r\n        this.openPos = this.node.position;\r\n\r\n        if (this.keyDir == KeyDir.Bottom_To_Top) {\r\n            this.openPos.y += this.joint.upperLimit;\r\n        } else if (this.keyDir == KeyDir.Left_To_Right) {\r\n            this.openPos.x += this.joint.upperLimit;\r\n        } else if (this.keyDir == KeyDir.Top_To_Bottom) {\r\n            this.openPos.y -= this.joint.upperLimit;\r\n        } else if (this.keyDir == KeyDir.Right_To_Left) {\r\n            this.openPos.x -= this.joint.upperLimit;\r\n        }\r\n\r\n\r\n        this.handler.on(cc.Node.EventType.TOUCH_START, this.click, this);\r\n\r\n        //destroy all collider in [handler]\r\n        let collider = this.handler.getComponent(cc.PhysicsCollider)\r\n        if (collider) {\r\n            collider.destroy();\r\n        }\r\n        let body = this.handler.getComponent(cc.RigidBody);\r\n        if (body) {\r\n            body.destroy();\r\n        }\r\n\r\n        this.collider = this.getComponent(cc.PhysicsCollider);\r\n        this.collider.friction = 0.2;\r\n\r\n        // this.addComponent(OneWayPlatform);\r\n\r\n\r\n        //create stop collider \r\n        // this.createStopSign();\r\n        if (this.shape == KeyShape.UNKNOWN) {\r\n            if (this.node.angle == 0) {\r\n                let ratio = this.node.width / this.node.height;\r\n                if (ratio < 2 && ratio > 1) {\r\n                    this.shape = KeyShape.DOOR;\r\n                } else if (ratio > 2) {\r\n                    this.shape = KeyShape.H;\r\n                    this.node.height = 13\r\n                } else {\r\n                    this.shape = KeyShape.V;\r\n                }\r\n            } else if (this.node.angle == 90) {\r\n                let ratio = this.node.width / this.node.height;\r\n                if (ratio < 2) {\r\n                    this.shape = KeyShape.H\r\n                    this.node.width = 13\r\n                } else {\r\n                    this.shape = KeyShape.V;\r\n                }\r\n            }\r\n        }\r\n        console.log(KeyShape[this.shape])\r\n        if (this.shape == KeyShape.H) {\r\n            // this.createStopSign();\r\n            this.getInvisibleHandler();\r\n\r\n        } else if (this.shape == KeyShape.V) {\r\n            this.getInvisibleHandler();\r\n            this.node.height = 13\r\n        } else if (this.shape == KeyShape.DOOR) {\r\n            this.createEdge(cc.v2(0, 1));\r\n            this.createEdge(cc.v2(-1, 0));\r\n            this.createEdge(cc.v2(1, 0));\r\n        } else if (this.shape == KeyShape.LEFTDOOR) {\r\n            this.createEdge(cc.v2(0, 1));\r\n            this.createEdge(cc.v2(-1, 0));\r\n            this.createEdge(cc.v2(1, 0));\r\n        } else if (this.shape == KeyShape.RIGHTDOOR) {\r\n            this.createEdge(cc.v2(0, 1));\r\n            this.createEdge(cc.v2(-1, 0));\r\n            this.createEdge(cc.v2(1, 0));\r\n        }\r\n        // if (PlayerInfo.isPlayingDaily) {\r\n        let sprites = this.getComponentsInChildren(cc.Sprite);\r\n        for (let i = 0; i < sprites.length; i++) {\r\n            ccUtil.setDisplay(sprites[i], \"Img/level/\" + sprites[i].spriteFrame.name + UserInfo.theme_key);\r\n        }\r\n        // }\r\n    }\r\n\r\n    createEdge(dir: cc.Vec2) {\r\n        let node = new cc.Node();\r\n        node.parent = this.node;\r\n        if (dir.y != 0) {\r\n            node.width = this.node.width;\r\n            node.height = 50;\r\n        } else if (dir.x != 0) {\r\n            node.width = 50;\r\n            node.height = this.node.height;\r\n        }\r\n\r\n        let pos = node.getPosition();\r\n        pos.addSelf(dir.multiply(cc.v2(this.node.width / 2, this.node.height / 2)))\r\n        node.setPosition(pos);\r\n        node.on(cc.Node.EventType.TOUCH_START, this.click, this);\r\n    }\r\n\r\n    async createStopSign() {\r\n        let prefab = await ccUtil.getRes(\"Prefabs/misc/stop\", cc.Prefab)\r\n        this.stopSign = cc.instantiate(prefab) as cc.Node;\r\n        this.node.addChild(this.stopSign)\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n\r\n    _isOpen: boolean = false;\r\n    curDir: cc.Vec2 = cc.v2();\r\n\r\n    get isOpen() {\r\n        return this._isOpen;\r\n    }\r\n\r\n    private _switch() {\r\n        if (this._isOpen) {\r\n            cc.tween(this.node).to(0.5, { position: this.openPos }, { easing: \"sineInOut\" }).call(this.onFinish.bind(this)).start()\r\n            this.curDir.y = this.openPos.y - this.node.y;\r\n        } else {\r\n            cc.tween(this.node).to(0.5, { position: this.originPos }, { easing: \"sineInOut\" }).call(this.onFinish.bind(this)).start()\r\n            this.curDir.y = this.originPos.y - this.node.y;\r\n        }\r\n\r\n    }\r\n\r\n    _invisibleHandler: cc.Node;\r\n\r\n    getInvisibleHandler() {\r\n        if (this._invisibleHandler == null) {\r\n            let invisible = new cc.Node();\r\n            invisible.width = this.node.width;\r\n            invisible.height = this.node.height;\r\n            if (this.node.width < this.node.height) {\r\n                invisible.width = 50;\r\n            } else {\r\n                invisible.height = 50;\r\n            }\r\n            invisible.parent = this.node;\r\n            invisible.on(cc.Node.EventType.TOUCH_START, this.click, this);\r\n            this._invisibleHandler = invisible;\r\n        }\r\n        return this._invisibleHandler;\r\n    }\r\n\r\n    checkNeedMoveBack() {\r\n        // if (this.strongArea) {\r\n        // this.getInvisibleHandler();\r\n        if (this._invisibleHandler) {\r\n            this._invisibleHandler.active = true;\r\n        }\r\n        return;\r\n        // }\r\n        if (!cc.Camera.main.canSee(this.handler)) {\r\n            this.getInvisibleHandler();\r\n            if (this._invisibleHandler) {\r\n                this._invisibleHandler.active = true;\r\n            }\r\n        } else {\r\n            if (this._invisibleHandler) {\r\n                this._invisibleHandler.active = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    toggle() {\r\n        this._canceled = false;\r\n        this._isOpen = !this._isOpen\r\n        this._switch();\r\n    }\r\n\r\n    _canceled = false;\r\n\r\n    cancel() {\r\n        this._canceled = true;\r\n        this._switch();\r\n    }\r\n\r\n    onFinish() {\r\n        if (this._canceled) return;\r\n        this.checkNeedMoveBack();\r\n        this.curDir.y = 0;\r\n        evt.emit(\"Game.keyMoved\", this)\r\n        this.onToggleSwitched.fire(this)\r\n    }\r\n\r\n    click() {\r\n        Game.instance.activeGame();\r\n        Device.playSfx(\"key\");\r\n        evt.emit(\"Game.keyClick\")\r\n        this.toggle();\r\n    }\r\n\r\n}"]}