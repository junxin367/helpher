{"version":3,"sources":["assets\\Game\\Scripts\\views\\WinGift.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { PlayerInfo } from \"../Common/Base/PlayerInfo\"\r\nimport { evt } from \"../../../framework/core/event\";\r\nimport { EaseType } from \"../../../framework/extension/qanim/EaseType\";\r\n\r\nlet { ccclass, property } = cc._decorator\r\nconst STEP = 0.25;\r\n@ccclass\r\nexport default class WinGift extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    label: cc.Label = null;\r\n\r\n    @property(cc.Sprite)\r\n    progress: cc.Sprite = null;\r\n\r\n    @property(cc.Node)\r\n    node_bg: cc.Node = null;\r\n\r\n\r\n    onLoad() {\r\n        evt.on(\"UIProgressRewardGet.show\", this.onShownReward, this)\r\n    }\r\n\r\n    onDestroy() {\r\n        evt.off(this);\r\n    }\r\n\r\n    preAddProgress() {\r\n        PlayerInfo.boxProgress += STEP;\r\n        PlayerInfo.save(\"boxProgress\")\r\n    }\r\n\r\n    postAddProgress() {\r\n        if (PlayerInfo.boxProgress >= 1) {\r\n            PlayerInfo.boxProgress = 0;\r\n            this.showGift();\r\n        }\r\n    }\r\n\r\n    onShownReward() {\r\n        this.node_bg.opacity = 0;\r\n    }\r\n\r\n    showGift() {\r\n        this.node_bg.opacity = 0;\r\n        cc.tween(this.node_bg).to(1.0, { opacity: 255 }).start();\r\n        cc.tween(this.node).to(1.0, { position: cc.v2(0, 0) }, { easing: \"sineInOut\" }).call(() => {\r\n            this.node.setPosition(-1000, -10000)\r\n            vm.show(\"Prefabs/UI/UIProgressReward\")\r\n        }).start();\r\n\r\n    }\r\n\r\n    show() {\r\n        this.node.active = true;\r\n        this.node_bg.opacity = 0;\r\n        if (PlayerInfo.winStatus == 1 && this.shouldAddProgress()) {\r\n            this.preAddProgress();\r\n            this.updateProgress();\r\n            this.postAddProgress();\r\n        } else {\r\n            this.updateProgress();\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        this.node_bg.opacity = 0;\r\n        this.node.active = false;\r\n    }\r\n\r\n    updateProgress() {\r\n        let prev = PlayerInfo.boxProgress - STEP;\r\n        prev = Math.max(0, prev);\r\n        this.label.string = PlayerInfo.boxProgress * 100 + \"%\"\r\n        this.progress.fillRange = prev;\r\n        cc.tween(this.progress).to(0.5, { fillRange: PlayerInfo.boxProgress }).start();\r\n    }\r\n\r\n    shouldAddProgress() {\r\n        if (PlayerInfo.winStatus == -1) return;\r\n        if (PlayerInfo.isPlayingDaily) {\r\n            if (PlayerInfo.playingDailyLevel == PlayerInfo.dailylevel) {\r\n                return true;\r\n            }\r\n            return false;\r\n        }\r\n        if (PlayerInfo.playinglevel == PlayerInfo.level) {\r\n            // add progress \r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n\r\n}"]}