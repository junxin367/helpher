{"version":3,"sources":["assets\\Game\\Scripts\\UI\\UISkinItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import mvcView from \"../../../framework/ui/mvcView\";\r\nimport Switcher from \"../../../framework/ui/controller/Switcher\";\r\nimport { PlayerInfo } from \"../Common/Base/PlayerInfo\";\r\nimport Platform from \"../../../framework/extension/Platform\";\r\nimport { evt } from \"../../../framework/core/event\";\r\nimport { Toast } from \"../../../framework/ui/ToastManager\";\r\nimport { SkinType } from \"./UISkin\";\r\nimport { UserInfo } from \"../../../framework/extension/weak_net_game/UserInfo\";\r\n\r\nlet { ccclass, property } = cc._decorator\r\n\r\nenum SkinUnlockType {\r\n    Level = 1,\r\n    Star,\r\n    Video,\r\n    Default = 4\r\n}\r\n\r\nenum StatusIndex {\r\n    Choosed = 0, // 已选择\r\n    Locked = 1, //锁\r\n    UnlockVideo = 2, //看视频 领取\r\n    Unlocked = 3, //已解锁 \r\n}\r\n\r\nconst Choosed_Color = new cc.Color().fromHEX(\"#FFFBDA\")\r\nconst Name_Color = new cc.Color().fromHEX(\"#504B68\")\r\nconst Unlock_Color = new cc.Color().fromHEX(\"#82FF52\")\r\n\r\n@ccclass\r\nexport default class UISKinItem extends mvcView {\r\n\r\n    @property(cc.Label)\r\n    nameLabel: cc.Label = null;\r\n    @property(Switcher)\r\n    switcher: Switcher = null;\r\n\r\n    //unlock condition\r\n    @property(cc.Label)\r\n    unlockDesc: cc.Label = null;\r\n\r\n    @property(cc.Sprite)\r\n    unlockIcon: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    icon: cc.Sprite = null;\r\n\r\n    @property(cc.Button)\r\n    btn_unlock_video: cc.Button = null\r\n\r\n    @property(cc.Button)\r\n    btn_unlock: cc.Button = null\r\n\r\n\r\n    @property(cc.Button)\r\n    btn_select: cc.Button = null\r\n\r\n    @property(cc.Node)\r\n    redPoint: cc.Node = null;\r\n\r\n    onLoad() {\r\n        evt.on(`Guide.unlockSkin`, this.onGuideUnlock, this);\r\n        evt.on(`Guide.useSkin`, this.onGuideSelect, this);\r\n\r\n        this.register<csv.Skin_Row>(this.switcher, (data) => {\r\n            this.node.color = cc.Color.WHITE;\r\n            this.btn_unlock.node.color = cc.Color.WHITE;\r\n            this.node.opacity = 255;\r\n            if (PlayerInfo.isSkinUnlocked(data.id)) {\r\n                //已解锁 \r\n                if (PlayerInfo.isSkinUsing(data.id)) {\r\n                    this.node.color = Choosed_Color;\r\n                    return StatusIndex.Choosed\r\n                } else {\r\n                    return StatusIndex.Unlocked;\r\n                }\r\n            } else {\r\n                //未解锁 状态 \r\n                if (data.unlockType == SkinUnlockType.Video) {\r\n                    return StatusIndex.UnlockVideo;\r\n                } else {\r\n                    if (data.unlockType == SkinUnlockType.Level || data.unlockType == SkinUnlockType.Star) {\r\n                        let unlock = this.canUnlock();\r\n                        // ccUtil.setButtonEnabled(this.btn_unlock, unlock)\r\n                        this.redPoint.active = unlock;\r\n                        if (!unlock) {\r\n                            this.node.opacity = 222;\r\n                        } else {\r\n                            this.btn_unlock.node.color = Unlock_Color;\r\n                        }\r\n                    }\r\n                    // this.nameLabel.node.color = cc.Color.RED;\r\n                    return StatusIndex.Locked;\r\n                }\r\n            }\r\n            return StatusIndex.Choosed;\r\n        })\r\n\r\n\r\n        this.register<csv.Skin_Row>(this.unlockDesc, (data) => {\r\n            if (data.unlockType == SkinUnlockType.Star) {\r\n                return \" x\" + data.unlock2 + \"颗解锁\";\r\n            } else {\r\n                return \"Lv\" + data.unlock1 + '关解锁 ';\r\n            }\r\n        })\r\n\r\n        this.register<csv.Skin_Row>(this.nameLabel, (data) => {\r\n            return data.name\r\n        })\r\n\r\n        this.register<csv.Skin_Row>(this.icon, (data) => \"Img/skin/thumbnail/\" + data.type + \"/\" + data.thumbnail);\r\n\r\n        this.onVisible<csv.Skin_Row>(this.unlockIcon.node, (data) => data.unlockType == SkinUnlockType.Star);\r\n        // this.register<csv.Skin_Row>(this.unlockIcon, (data) => {\r\n        //     if (data.unlockType == SkinUnlockType.Star) {\r\n        //         return 'Img/main/star';\r\n        //     } else if (data.unlockType == SkinUnlockType.Level) {\r\n        //         return '';\r\n        //     }\r\n        // })\r\n        this.register(this.btn_unlock_video, this.click_unlockvideo)\r\n        this.register(this.btn_unlock, this.click_unlock)\r\n        this.register(this.btn_select, this.click_select)\r\n\r\n    }\r\n    \r\n    onDestroy() {\r\n        evt.off(this);\r\n    }\r\n\r\n    /**j是否可以解锁  */\r\n    canUnlock() {\r\n        let d: csv.Skin_Row = this.getData() as csv.Skin_Row;\r\n        if (d.unlockType == SkinUnlockType.Level && PlayerInfo.level >= d.unlock1) {\r\n            return true;\r\n        } else if (d.unlockType == SkinUnlockType.Star && PlayerInfo.star >= d.unlock2) {\r\n            return true;\r\n        } else if (d.unlockType == SkinUnlockType.Video) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n\r\n    click_unlockvideo() {\r\n        Platform.watch_video(this.onvideocallback, this);\r\n    }\r\n\r\n    unlock() {\r\n        let d: csv.Skin_Row = this.getData() as csv.Skin_Row;\r\n        PlayerInfo.unlockSkin(d.id);\r\n        Toast.make(\"已解锁：\" + d.name);\r\n        this.render(d);\r\n    }\r\n\r\n    onvideocallback() {\r\n        this.unlock();\r\n    }\r\n\r\n    click_unlock() {\r\n        let data = this.getData() as csv.Skin_Row;\r\n        if (this.canUnlock()) {\r\n            PlayerInfo.unlockSkin(data.id)\r\n            Toast.make(\"已解锁：\" + data.name)\r\n            evt.emit('UISkin.checkLock');\r\n            this.render(data)\r\n        }\r\n        else {\r\n            if (data.unlockType == 1) {\r\n                Toast.make(\"达到\" + data.unlock1 + \"关解锁\")\r\n            }\r\n            else if (data.unlockType == 2) {\r\n                Toast.make(\"获取\" + data.unlock2 + \"颗星星解锁\")\r\n            }\r\n        }\r\n    }\r\n\r\n    click_select() {\r\n        let data = this.getData() as csv.Skin_Row;\r\n        // if (UserInfo.skin_guide === 0 && data.id === 20) { // 初次解锁引导\r\n        //     UserInfo.skin_guide = 1;\r\n        //     UserInfo.save('skin_guide');\r\n        // }\r\n        if (data.type == SkinType.Theme) {\r\n            UserInfo.theme = data.data;\r\n        }\r\n        else {\r\n            if (PlayerInfo.isSkinUnlocked(data.id)) {\r\n                PlayerInfo.useSkin(data.id);\r\n                this.render(data);\r\n                //选择需要 取消选择其它同类项目\r\n                evt.emit('Skin.select', data)\r\n            }\r\n        }\r\n    }\r\n\r\n    click_unlockstar() {\r\n\r\n    }\r\n\r\n    onGuideUnlock() {\r\n        let data = this.getData() as csv.Skin_Row;\r\n        data && data.id === 20 && this.click_unlock();\r\n    }\r\n\r\n    onGuideSelect() {\r\n        let data = this.getData() as csv.Skin_Row;\r\n        data && data.id === 20 && this.click_select();\r\n    }\r\n}"]}