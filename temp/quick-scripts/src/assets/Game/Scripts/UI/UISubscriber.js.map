{"version":3,"sources":["assets\\Game\\Scripts\\UI\\UISubscriber.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,yDAAoD;AACpD,8DAA+D;AAC/D,mEAA2D;AAC3D,gFAA+E;AAC/E,sFAAiF;AACjF,4DAAkD;AAClD,mDAA8C;AAC9C,uCAAsC;AAGhC,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAA0C,gCAAO;IAAjD;QAAA,qEA4DC;QA1DG,eAAS,GAAY,IAAI,CAAC;QAM1B,eAAS,GAAY,KAAK,CAAC;;IAoD/B,CAAC;IAlDG,6BAAM,GAAN;QAAA,iBAEC;QADG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,EAAE,UAAA,CAAC,IAAI,OAAA,KAAI,CAAC,WAAW,EAAE,EAAlB,CAAkB,CAAC,CAAC;IAC1D,CAAC;IACD,6BAAM,GAAN,UAAO,QAAQ;QACX,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,MAAM,EAAE,CAAC;IAClB,CAAC;IAED,kCAAW,GAAX;QACI,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAClB,CAAC;IAED,uCAAgB,GAAhB;QAAA,iBAIC;QAHG,WAAK,CAAC,uBAAuB,EAAE,CAAC,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,KAAI,CAAC,YAAY,EAAE,EAAnB,CAAmB,CAAC,CAAC,KAAK,CAAC,UAAA,CAAC;YAClE,oBAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QACvB,CAAC,CAAC,CAAA;IACN,CAAC;IAED,mCAAY,GAAZ;QACI,gBAAgB;QAChB,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACd,qBAAW,CAAC,MAAM,CAAC,OAAO,CAAC,kBAAG,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,UAAA,CAAC;YAC5C,IAAI,CAAC,IAAI,aAAG,CAAC,IAAI,CAAC,OAAO,EAAE;gBACvB,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;aACvB;iBAAM;gBACH,IAAI,CAAC,EAAE;oBACH,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;oBACtB,IAAI,CAAC,CAAC,KAAK,IAAI,CAAC,EAAE;wBACd,CAAC,GAAG,CAAC,CAAC,IAAI,CAAA;wBACV,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;wBACvB,eAAe;wBACf,oBAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;wBAClB,mBAAQ,CAAC,IAAI,GAAG,IAAI,CAAC;wBACrB,mBAAQ,CAAC,IAAI,EAAE,CAAC;wBAChB,EAAE,CAAC,IAAI,CAAC,yBAAyB,EAAE,GAAG,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;qBACrE;yBAAM;wBACH,OAAO,CAAC,GAAG,CAAC,OAAO,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;wBAC/B,IAAI,CAAC,CAAC,KAAK,IAAI,WAAI,CAAC,eAAe,EAAE;4BACjC,oBAAK,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;4BACrB,mBAAQ,CAAC,IAAI,GAAG,IAAI,CAAC;4BACrB,mBAAQ,CAAC,IAAI,EAAE,CAAC;yBACnB;qBACJ;iBACJ;qBAAM;iBAEN;aACJ;QACL,CAAC,CAAC,CAAA;IACN,CAAC;IAxDD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;mDACQ;IAFT,YAAY;QADhC,OAAO;OACa,YAAY,CA4DhC;IAAD,mBAAC;CA5DD,AA4DC,CA5DyC,iBAAO,GA4DhD;kBA5DoB,YAAY","file":"","sourceRoot":"/","sourcesContent":["import mvcView from \"../../../framework/ui/mvcView\";\nimport { wxsdk } from \"../../../framework/extension/wxsdk/sdk\";\nimport { Toast } from \"../../../framework/ui/ToastManager\";\nimport { UserInfo } from \"../../../framework/extension/weak_net_game/UserInfo\";\nimport WeakNetGame from \"../../../framework/extension/weak_net_game/WeakNetGame\";\nimport { Api } from \"../Common/Base/ServerConfig\";\nimport Net from \"../../../framework/misc/Net\";\nimport { Code } from \"../Common/code\";\nimport { evt } from \"../../../framework/core/event\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class UISubscriber extends mvcView {\n    @property(cc.Node)\n    btn_close: cc.Node = null;\n\n\n\n    callback: Function;\n\n    isSuccess: boolean = false;\n\n    onLoad() {\n        this.onClick(this.btn_close, _ => this.click_close());\n    }\n    onShow(callback) {\n        this.callback = callback;\n        this.render();\n    }\n\n    click_close() {\n        vm.hide(this);\n    }\n\n    click_subscriber() {\n        wxsdk.requestSubscribeMessage().then(v => this.notifyServer()).catch(v => {\n            Toast.make(\"订阅失败!\")\n        })\n    }\n\n    notifyServer() {\n        //ids 所有接受的 模板id\n        vm.hide(this);\n        WeakNetGame.client.httpGet(Api.subscribe).then(v => {\n            if (v == Net.Code.Timeout) {\n                console.log(\"连接超时！\")\n            } else {\n                if (v) {\n                    let d = JSON.parse(v);\n                    if (d.errno == 0) {\n                        d = d.data\n                        console.log(\"返回数据\", d);\n                        //根据返回数据做对应逻辑处理\n                        Toast.make(\"订阅成功\")\n                        UserInfo.isDy = true;\n                        UserInfo.save();\n                        vm.show(\"Prefabs/UI/UIGetSuccess\", csv.Config.Subscriber_Success);\n                    } else {\n                        console.log(\"返回错误码\" + d.errno);\n                        if (d.errno == Code.Subscribe_ERROR) {\n                            Toast.make(d.errmsg);\n                            UserInfo.isDy = true;\n                            UserInfo.save();\n                        }\n                    }\n                } else {\n\n                }\n            }\n        })\n    }\n\n}\n"]}