{"version":3,"sources":["assets\\Game\\Scripts\\UI\\UISign.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ccUtil from \"../../../framework/utils/ccUtil\";\r\nimport { PlayerInfo } from \"../Common/Base/PlayerInfo\";\r\nimport gameUtil from \"../../../framework/utils/gameUtil\";\r\nimport WeakNetGame from \"../../../framework/extension/weak_net_game/WeakNetGame\";\r\nimport { evt } from \"../../../framework/core/event\";\r\nimport mvcView from \"../../../framework/ui/mvcView\";\r\nimport mathf from \"../../../framework/utils/mathf\";\r\nimport display from \"../../../framework/misc/display\";\r\nimport { UserInfo } from \"../../../framework/extension/weak_net_game/UserInfo\";\r\nimport { Toast } from \"../../../framework/ui/ToastManager\";\r\nimport actionUtil from \"../../../framework/utils/actionUtil\";\r\nimport Main from \"../Main\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nexport interface SignData {\r\n    day: number;\r\n    imageUrl: string;\r\n    iconLoop: string;\r\n    num: number;\r\n    type: number;\r\n    typeLoop: number;\r\n    btnString: string;\r\n    btnLoopString: string;\r\n}\r\n\r\nclass DayNode {\r\n    label_title: cc.Label = null;\r\n    icon: cc.Sprite = null;\r\n    label_num: cc.Label = null;\r\n    node_claimed: cc.Node = null;\r\n    public constructor(node: cc.Node) {\r\n        this.label_title = ccUtil.find(\"title\", node, cc.Label)\r\n        this.icon = ccUtil.find(\"icon\", node, cc.Sprite);\r\n        this.label_num = ccUtil.find(\"num\", node, cc.Label);\r\n        this.node_claimed = node.getChildByName(\"claimed\")\r\n    }\r\n\r\n    setData(data: SignData, claimed: boolean, isloop: boolean = false) {\r\n        this.node_claimed.active = claimed;\r\n        if (isloop) {\r\n            data.imageUrl = data.iconLoop;\r\n        }\r\n        if (data.imageUrl)\r\n            ccUtil.setDisplay(this.icon, data.imageUrl);\r\n        this.label_title.string = '第' + data.day + \"日\"\r\n        if (this.label_num) {\r\n            this.label_num.string = 'x' + data.num;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * csv 表头\r\n * \r\n天数\t奖励内容\t奖励数量\t图标\r\nday\treward\tnumber\ticon\r\nint\tstring\tint\tstring\r\n1\tgold\t200\tgold\r\n\r\n    (DC)PlayerInfo \r\n        -CheckInTime  签到时间 \r\n        -CheckInCount 签到次数\r\n    \r\n    UI  预置体说明：\r\n     * dayCotainer\r\n     *  - day\r\n     *      -title\r\n     *      -icon\r\n     *      -num\r\n     *      -claimed\r\n */\r\n\r\n\r\n@ccclass\r\nexport default class UISign extends mvcView {\r\n\r\n    @property(cc.Node)\r\n    dayContainer: cc.Node = null;\r\n    days: DayNode[] = []\r\n    daysData: SignData[] = []\r\n    @property(cc.Toggle)\r\n    toggle: cc.Toggle = null\r\n\r\n    @property(cc.Label)\r\n    btnstring_label: cc.Label = null\r\n\r\n    @property(cc.Label)\r\n    seven_label: cc.Label = null\r\n\r\n    @property(cc.Button)\r\n    btn_claim: cc.Button = null;\r\n\r\n    @property(cc.Node)\r\n    claimedTip_label: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    claimedTip: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    icon_ad: cc.Node = null;\r\n\r\n    isLoop: boolean = false;\r\n\r\n    onLoad() {\r\n        this.dayContainer.children.forEach(v => {\r\n            let dayNode = new DayNode(v)\r\n            this.days.push(dayNode)\r\n        });\r\n        csv.Sign.values.forEach((v, i) => {\r\n            this.daysData.push({ type: v.type, day: i + 1, imageUrl: v.icon, num: v.number, btnString: v.btnString, iconLoop: v.iconLoop, typeLoop: v.typeLoop, btnLoopString: v.btnLoopString } as SignData)\r\n        })\r\n        this.register(this.btn_claim, this.click_checkIn);\r\n        this.icon_ad.active = false;\r\n    }\r\n\r\n    onShown() {\r\n        actionUtil.jellyJump2(this.node);\r\n        let c = 0;\r\n        if (PlayerInfo.signCount >= 7) {\r\n            this.isLoop = true;\r\n        }\r\n        for (var i = 0; i < this.days.length; i++) {\r\n            let day = i;\r\n            let dayNode = this.days[i];\r\n            let claimed = day < mathf.Repeat(PlayerInfo.signCount, 7);\r\n            c = claimed ? c + 1 : c;\r\n            dayNode.setData(this.daysData[i], claimed, this.isLoop);\r\n        }\r\n        //全部领取完毕\r\n        if (c == this.days.length) {\r\n            // this.btn_claim.node.active = false;\r\n            // ccUtil.setButtonEnabled(this.btn_claim, false);\r\n            this.btn_claim.node.active = false;\r\n            this.claimedTip.active = false;\r\n            this.claimedTip_label.active = true;\r\n            return;\r\n        }\r\n        let day = mathf.Repeat(PlayerInfo.signCount, 7)\r\n        let data = this.daysData[day];\r\n        if (this.isLoop) {\r\n            this.btnstring_label.string = data.btnLoopString;\r\n            this.seven_label.node.active = false;\r\n        }\r\n        else {\r\n            this.btnstring_label.string = data.btnString;\r\n        }\r\n        this.updateStatus()\r\n    }\r\n    updateStatus(day?) {\r\n        if (gameUtil.isNextDay(PlayerInfo.signTime)) {\r\n            //可领取\r\n            // ccUtil.setButtonEnabled(this.btn_claim, true);\r\n            this.btn_claim.node.active = true;\r\n            this.claimedTip.active = false;\r\n            this.claimedTip_label.active = true;\r\n        } else {\r\n            //已领取\r\n            // ccUtil.setButtonEnabled(this.btn_claim, false);\r\n            this.btn_claim.node.active = false;\r\n            this.claimedTip.active = true;\r\n            this.claimedTip_label.active = false;\r\n        }\r\n        if (day) {\r\n            let dayNode = this.days[day];\r\n            let data = this.daysData[day];\r\n            dayNode.setData(data, day < mathf.Repeat(PlayerInfo.signCount, 7), this.isLoop);\r\n        }\r\n    }\r\n\r\n\r\n    check_double() {\r\n        this.icon_ad.active = this.toggle.isChecked;\r\n    }\r\n\r\n\r\n    //签到  \r\n    click_checkIn() {\r\n        if (this.toggle.isChecked) {\r\n\r\n            WeakNetGame.doChoice(\"SOV_Sign_Double\", this.claimDouble, this);\r\n        } else {\r\n            this.claim();\r\n        }\r\n        vm.hide(this)\r\n    }\r\n\r\n    claimDouble() {\r\n        this.claim(2);\r\n        vm.hide(this)\r\n    }\r\n\r\n\r\n    ////////////////////////////////////////////////////////////////\r\n    // 领取第n天的奖励\r\n    claim(mult = 1) {\r\n        let day = mathf.Repeat(PlayerInfo.signCount, 7);\r\n        Main.instance.qiandao_hongdian.active = false;\r\n        PlayerInfo.signTime = Date.now();\r\n        PlayerInfo.signCount++;\r\n        PlayerInfo.save();\r\n        let data = this.daysData[day];\r\n        if (this.isLoop) {\r\n            data.type = data.typeLoop;\r\n        }\r\n        if (data.type == 1) {\r\n            PlayerInfo.labour += (data.num * mult);\r\n            evt.emit(\"Game.getTili\", display.center, (data.num * mult))\r\n        }\r\n        else if (data.type == 2) {\r\n            UserInfo.gun_num += (data.num * mult);\r\n            UserInfo.snowball_num += (data.num * mult);\r\n            UserInfo.magnet_num += (data.num * mult);\r\n            Toast.make(\"恭喜获得道具礼包\");\r\n            UserInfo.save();\r\n        }\r\n        else {\r\n            PlayerInfo.unlockSkin(13);\r\n            Toast.make(\"恭喜获得限定皮肤\");\r\n        }\r\n        // evt.emit(\"UICheckIn.getReward\", data, mult)\r\n        this.updateStatus(day);\r\n    }\r\n    ////////////////////////////////////////////////////////////////\r\n    click_close() {\r\n        vm.hide(this);\r\n    }\r\n}\r\n\r\n"]}