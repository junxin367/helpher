{"version":3,"sources":["assets\\Game\\Scripts\\UI\\UIDayInviteItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import mvcView from \"../../../framework/ui/mvcView\";\r\nimport Platform from \"../../../framework/extension/Platform\";\r\nimport Switcher from \"../../../framework/ui/controller/Switcher\";\r\nimport WeakNetGame from \"../../../framework/extension/weak_net_game/WeakNetGame\";\r\nimport { Api } from \"../Common/Base/ServerConfig\";\r\nimport Net from \"../../../framework/misc/Net\";\r\nimport { Toast } from \"../../../framework/ui/ToastManager\";\r\nimport UIFriendHelp, { DayInvite } from \"./UIFriendHelp\";\r\nimport { PlayerInfo } from \"../Common/Base/PlayerInfo\";\r\nimport { evt } from \"../../../framework/core/event\";\r\n\r\nlet { ccclass, property } = cc._decorator\r\n\r\nconst index_count = [3, 1, 1]\r\n\r\n@ccclass\r\nexport default class UIDayInviteItem extends mvcView {\r\n\r\n    @property(cc.Label)\r\n    label_count: cc.Label = null;\r\n\r\n    @property(cc.Sprite)\r\n    icon: cc.Sprite = null;\r\n\r\n    @property(Switcher)\r\n    tg_btn: Switcher = null\r\n\r\n    index: number = 0;\r\n\r\n    onLoad() {\r\n        this.register(this.tg_btn, () => {\r\n            if (this.data == null) return 0;\r\n            if (this.data.status == 0) return 1\r\n            return 2;\r\n        })\r\n        this.register(this.label_count, () => {\r\n            if (this.data && this.data.count) {\r\n                return \"x\" + this.data.count\r\n            } else {\r\n                return index_count[this.index]\r\n            }\r\n        });\r\n        this.register(this.icon, () => {\r\n            if (this.data) {\r\n                return this.data.avatarUrl || \"Img/rank/moren\";\r\n            }\r\n            return \"Img/all/empty\";\r\n        })\r\n    }\r\n\r\n    setData(data, i) {\r\n        this.index = i\r\n        this.render(data)\r\n    }\r\n\r\n    get data() {\r\n        return this.getData() as DayInvite\r\n    }\r\n\r\n    click_invite() {\r\n        Platform.share();\r\n    }\r\n\r\n    click_claim() {\r\n        WeakNetGame.client.httpGet(Api.invite_claim_day, { id: this.data._id }).then(v => {\r\n            if (v != Net.Code.Timeout) {\r\n                if (v) {\r\n                    let d = JSON.parse(v)\r\n                    if (d.errno == 0) {\r\n                        let data = d.data\r\n                        let add = data.num || index_count[this.index]\r\n                        let c = PlayerInfo.labour + add\r\n                        PlayerInfo.labour = c;\r\n                        PlayerInfo.save('labour');\r\n                        Toast.make(\"成功领取\" + add + \"个体力\");\r\n                        this.data.status = 1;\r\n                        this.render(this.data);\r\n                        evt.emit(\"Game.friendTili\", UIFriendHelp.day_invite, UIFriendHelp.sum_invite)\r\n                    } else {\r\n                        //fail\r\n                        console.log(d.errno)\r\n                        Toast.make(\"领取失败:\" + d.errno)\r\n                    }\r\n                } else {\r\n                    Toast.make(\"服务器出错!\")\r\n                }\r\n            } else {\r\n                Toast.make(\"领取超时!\")\r\n            }\r\n        })\r\n    }\r\n\r\n}"]}