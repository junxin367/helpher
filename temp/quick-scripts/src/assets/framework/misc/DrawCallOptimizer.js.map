{"version":3,"sources":["assets\\framework\\misc\\DrawCallOptimizer.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qDAAgD;AAChD,uCAAoC;AACpC,0CAAqC;AAE/B,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAC5C,IAAY,OAWX;AAXD,WAAY,OAAO;IACf,yCAAM,CAAA;IACN,yCAAM,CAAA;IACN,yCAAM,CAAA;IACN,yCAAM,CAAA;IACN,yCAAM,CAAA;IACN,yCAAM,CAAA;IACN,yCAAM,CAAA;IACN,yCAAM,CAAA;IACN,yCAAM,CAAA;IACN,yCAAM,CAAA;AACV,CAAC,EAXW,OAAO,GAAP,eAAO,KAAP,eAAO,QAWlB;AAED,IAAI,UAAU,GAAG,EAAE,CAAA;AAGnB;IAA+C,qCAAY;IAA3D;QAAA,qEA+CC;QA7CG,uBAAiB,GAAc,EAAE,CAAA;QAGjC,cAAQ,GAAY,IAAI,CAAC;QAGzB,aAAO,GAAY,OAAO,CAAC,MAAM,CAAC;;IAuCtC,CAAC;IArCG,kCAAM,GAAN;QACI,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,IAAI,CAAC;QAC3C,WAAG,CAAC,EAAE,CAAC,aAAa,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAA;QAC1C,WAAG,CAAC,EAAE,CAAC,gBAAgB,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAA;QAChD,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC;IACpC,CAAC;IAEM,8BAAY,GAAnB,UAAoB,OAAO;QACvB,OAAO,UAAU,CAAC,OAAO,CAAC,CAAA;IAC9B,CAAC;IAED,qCAAS,GAAT;QACI,OAAO,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QAC/B,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IACpB,CAAC;IAED,iCAAK,GAAL;QAAA,iBAGC;QAFG,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,gBAAM,CAAC,YAAY,CAAC,CAAC,EAAE,KAAI,CAAC,QAAQ,CAAC,EAArC,CAAqC,CAAC,CAAC;QAC3E,IAAI,CAAC,WAAW,EAAE,CAAC;IACvB,CAAC;IAED,oCAAQ,GAAR,UAAS,QAA2B;QAApC,iBAKC;QAJG,QAAQ,CAAC,OAAO,CAAC,UAAA,CAAC;YACd,IAAI,CAAC,CAAC,OAAO,IAAI,KAAI,CAAC,OAAO;gBACzB,gBAAM,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,EAAE,KAAI,CAAC,QAAQ,CAAC,CAAC;QACnD,CAAC,CAAC,CAAA;IACN,CAAC;IAED,uCAAW,GAAX;QACI,IAAI,QAAQ,GAAG,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,uBAAuB,CAAC,yBAAe,CAAC,CAAA;QAC9E,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAA;IAC3B,CAAC;IAED,0CAAc,GAAd,UAAe,IAAa;QACxB,gBAAM,CAAC,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC7C,CAAC;IA3CD;QADC,QAAQ,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;gEACa;IAGjC;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;uDACO;IAGzB;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;sDACH;IARjB,iBAAiB;QADrC,OAAO;OACa,iBAAiB,CA+CrC;IAAD,wBAAC;CA/CD,AA+CC,CA/C8C,EAAE,CAAC,SAAS,GA+C1D;kBA/CoB,iBAAiB","file":"","sourceRoot":"/","sourcesContent":["import DrawCallReorder from \"./DrawCallReorder\";\r\nimport { evt } from \"../core/event\";\r\nimport ccUtil from \"../utils/ccUtil\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\nexport enum DCIndex {\r\n    index0,\r\n    index1,\r\n    index2,\r\n    index3,\r\n    index4,\r\n    index5,\r\n    index6,\r\n    index7,\r\n    index8,\r\n    index9,\r\n}\r\n\r\nlet optimizers = {}\r\n\r\n@ccclass\r\nexport default class DrawCallOptimizer extends cc.Component {\r\n    @property([cc.Node])\r\n    tobeOptimizeNodes: cc.Node[] = []\r\n\r\n    @property(cc.Node)\r\n    newLayer: cc.Node = null;\r\n\r\n    @property({ type: cc.Enum(DCIndex) })\r\n    orderId: DCIndex = DCIndex.index0;\r\n\r\n    onLoad() {\r\n        this.newLayer = this.newLayer || this.node;\r\n        evt.on(\"DC.optimize\", this.optimize, this)\r\n        evt.on(\"DC.optimizeAll\", this.optimizeAll, this)\r\n        optimizers[this.orderId] = this;\r\n    }\r\n\r\n    static getOptimizer(orderId): DrawCallOptimizer {\r\n        return optimizers[orderId]\r\n    }\r\n\r\n    onDestroy() {\r\n        delete optimizers[this.orderId]\r\n        event.off(this);\r\n    }\r\n\r\n    start() {\r\n        this.tobeOptimizeNodes.forEach(v => ccUtil.changeParent(v, this.newLayer));\r\n        this.optimizeAll();\r\n    }\r\n\r\n    optimize(reorders: DrawCallReorder[]) {\r\n        reorders.forEach(v => {\r\n            if (v.orderId == this.orderId)\r\n                ccUtil.changeParent(v.node, this.newLayer);\r\n        })\r\n    }\r\n\r\n    optimizeAll() {\r\n        let reorders = cc.director.getScene().getComponentsInChildren(DrawCallReorder)\r\n        this.optimize(reorders)\r\n    }\r\n\r\n    optimizeTarget(node: cc.Node) {\r\n        ccUtil.changeParent(node, this.newLayer);\r\n    }\r\n\r\n}"]}