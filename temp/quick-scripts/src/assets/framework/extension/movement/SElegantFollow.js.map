{"version":3,"sources":["assets\\framework\\extension\\movement\\SElegantFollow.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,yCAAmC;AAE7B,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAE1C;IAA2C,iCAAQ;IAAnD;QAAA,qEAoEC;QAlEG,cAAQ,GAAU,EAAE,CAAC;QACrB,SAAG,GAAW,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC;QACzB,kBAAY,GAAW,IAAI,CAAC;QAE5B,iBAAW,GAAU,CAAC,CAAC;QAEvB,iBAAW,GAAU,EAAE,CAAC;QAGxB,yBAAmB,GAAU,CAAC,CAAC;;IAyDnC,CAAC;IAvDG,8BAAM,GAAN;IAEA,CAAC;IAED,6BAAK,GAAL;QAEI,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC;QACtB,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;QACvB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;QACrB,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;IACpB,CAAC;IAED,uCAAe,GAAf;QAEI,IAAG,CAAC,IAAI,CAAC,MAAM;YAAE,OAAO;QACxB,KAAK;QACL,IAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAC5C,IAAI,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,CAAC,MAAM,CAAA;QAC1D,IAAI,CAAC,GAAG,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAClC,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC;IACjE,CAAC;IAED,6BAAK,GAAL,UAAM,EAAG;QAEL,oBAAoB;QACpB,IAAI,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,CAAA;QAC1D,IAAG,IAAI,CAAC,YAAY,EACpB;YACI,IAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAG,GAAE,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,CAAE,CAAG,GAAG,EAAE,EACtD;gBACI,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,CAAA;gBAChE,mBAAmB;aACtB;iBAAI;gBACD,IAAI,CAAC,eAAe,EAAE,CAAC;aAC1B;SACJ;QACD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QAC3C,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC7D,IAAG,IAAI,CAAC,gBAAgB,EACxB;YACI,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,cAAc,GAAG,GAAG,CAAE;SACnD;IACL,CAAC;IAED,gCAAQ,GAAR;QAEI,+DAA+D;IACnE,CAAC;IAED,iCAAS,GAAT;QAEI,mBAAmB;QACnB,yCAAyC;IAC7C,CAAC;IAvDD;QADC,QAAQ,CAAC,EAAC,OAAO,EAAC,gCAAgC,EAAC,CAAC;8DACtB;IAXd,aAAa;QADjC,OAAO;OACa,aAAa,CAoEjC;IAAD,oBAAC;CApED,AAoEC,CApE0C,mBAAQ,GAoElD;kBApEoB,aAAa","file":"","sourceRoot":"/","sourcesContent":["import MoveBase from \"./SMoveBase\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n@ccclass\r\nexport default class ElegantFollow extends MoveBase\r\n{\r\n    maxSpeed:number = 10;\r\n    dir:cc.Vec2 = cc.Vec2.UP;\r\n    enableTarget:boolean = true;\r\n\r\n    targetAngle:number = 0;\r\n\r\n    rotateSpeed:number = 10;\r\n\r\n    @property({tooltip:\"0-1 is appropriate value range\"})\r\n    intervalCheckTarget:number = 1;\r\n\r\n    onLoad()\r\n    {\r\n    }\r\n\r\n    reset()\r\n    {\r\n        this.dir = cc.Vec2.UP;\r\n        this.node.rotation = 0;\r\n        this.targetAngle = 0;\r\n        this.tar = null;\r\n    }\r\n\r\n    onTargetChanged()\r\n    {\r\n        if(!this.target) return;\r\n        //dir\r\n        let box = this.node.getBoundingBoxToWorld();\r\n        let targetpos = this.target.getBoundingBoxToWorld().center\r\n        let v = targetpos.sub(box.center);\r\n        this.targetAngle = v.signAngle(cc.Vec2.RIGHT) * cc.macro.DEG;\r\n    }\r\n\r\n    _step(dt?)\r\n    {\r\n        // move via velocity\r\n        let ang = this.dir.signAngle(cc.Vec2.RIGHT) * cc.macro.DEG\r\n        if(this.enableTarget)\r\n        {\r\n            if(Math.abs((ang  )% 360 - (this.targetAngle )  ) > 30)\r\n            {\r\n                this.dir = this.dir.rotateSelf(-cc.macro.RAD * this.rotateSpeed)\r\n                // 绕半全后重新计算 target \r\n            }else{\r\n                this.onTargetChanged();\r\n            }\r\n        }\r\n        this.velocity = this.dir.mul(this.maxSpeed)\r\n        this.node.setPosition(this.node.position.add(this.velocity));\r\n        if(this.rotateByVelocity  )\r\n        {\r\n            this.node.rotation = this.rotationOffset + ang ;\r\n        }\r\n    }\r\n\r\n    onEnable()\r\n    {\r\n        // this.schedule(this.onTargetChanged,this.intervalCheckTarget)\r\n    }\r\n\r\n    onDisable()\r\n    {\r\n        // get target angle\r\n        // this.unschedule(this.onTargetChanged);\r\n    }\r\n\r\n}"]}