{"version":3,"sources":["assets\\framework\\extension\\weak_net_game\\UserInfo.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import DataCenter, { dc, field } from \"../../core/DataCenter\";\r\nimport WeakNetGame from \"./WeakNetGame\";\r\nimport gameUtil from \"../../utils/gameUtil\";\r\nimport Platform, { AuthUserInfo } from \"../Platform\";\r\nlet firstEnterHome = true\r\n@dc(\"UserInfo\")\r\nexport default class UserInfoDC extends DataCenter {\r\n    // @field()\r\n    // ip_cname: string = \"\"\r\n\r\n    // @field()\r\n    // ip_addr: string = \"\"\r\n\r\n    // @field()\r\n    // ip_s: number = 0;\r\n\r\n    @field()\r\n    lastLoginTime: number = 0\r\n\r\n    @field()\r\n    isFirstLoginToday: boolean = false;\r\n\r\n    /**需要在进入后置为false */\r\n    @field()\r\n    isFirstEnterGame: boolean = true;\r\n\r\n    //================-----------------------\r\n    /**每日分享录屏次数 */\r\n    @field()\r\n    sharecount: number = 0;\r\n    @field()\r\n    nickName: string = '';\r\n    /**每日展示开屏次数 */\r\n    @field()\r\n    kaipingcount: number = 0;\r\n    @field()\r\n    userId: string = '';\r\n\r\n    @field()\r\n    avatarUrl: string = '';\r\n\r\n    //累计失败次数\r\n    @field()\r\n    lose_num: number = 1;\r\n\r\n    //================-----------------------\r\n\r\n    @field()\r\n    firstLoginTime: number = 0;\r\n\r\n    /**最后一次退出游戏 的时间 ,秒为单位  */\r\n    @field()\r\n    lastExitTime: number = 0;\r\n\r\n    @field()\r\n    gender: number = 0;\r\n\r\n    // （新玩家）当天退出游戏再进也算 \r\n    isNew = false;\r\n\r\n    //当天第一次结算\r\n    isFirstGameOver = true;\r\n\r\n    /**第一次游戏结算时间 */\r\n    @field()\r\n    FirstGameOverTime: number = 0;\r\n\r\n    /**是否订阅 */\r\n    @field()\r\n    isDy: boolean = false;\r\n\r\n\r\n    /**是否客服会话*/\r\n    @field()\r\n    isKf: boolean = false;\r\n\r\n    /**是否刚才打开客服*/\r\n    tmpIskf: boolean = false;\r\n\r\n    /**是否刚才打开收藏*/\r\n    tmpIsSc: boolean = false;\r\n\r\n    /**是否领取过客服奖励 */\r\n    @field()\r\n    isGetKf: boolean = false;\r\n\r\n    /**进入客服会话的时间 */\r\n    @field()\r\n    kfTime: number = 0;\r\n\r\n    /**是否添加到我的小程序 */\r\n    @field()\r\n    isSc: boolean = false;\r\n\r\n    /**是否领取过收藏奖励 */\r\n    @field()\r\n    isGetSc: boolean = false;\r\n\r\n    /**是否使用过体力 */\r\n    @field()\r\n    isUse: boolean = false;\r\n\r\n    //枪的数量\r\n    @field()\r\n    gun_num: number = 0;\r\n\r\n    //雪球的数量\r\n    @field()\r\n    snowball_num: number = 0;\r\n\r\n    //磁铁的数量\r\n    @field()\r\n    magnet_num: number = 0;\r\n\r\n\r\n    //是否从开始按钮领取\r\n    @field()\r\n    isGetGunStart: boolean = false;\r\n\r\n    //是否从结算界面领取\r\n    @field()\r\n    isGetGunEnd: boolean = false;\r\n\r\n    //领取枪的时间\r\n    @field()\r\n    getGunTime: number = 0;\r\n\r\n    //累计重试次数\r\n    @field()\r\n    return_num: number = 1;\r\n\r\n    //累计重试次数的关卡\r\n    @field()\r\n    return_level: number = 0;\r\n\r\n    record_path: string = '';\r\n\r\n    start_time: number = 0;\r\n    record_time: number = 0;\r\n\r\n    //免费转盘次数\r\n    @field()\r\n    freedrawTime: number = 0;\r\n\r\n\r\n    @field()\r\n    auth: boolean = false;\r\n\r\n    //领取枪弹窗的总数量\r\n    @field()\r\n    gunView: number = 0;\r\n\r\n    //领取枪弹窗的每日\r\n    @field()\r\n    gunViewDay: number = 0;\r\n\r\n    //游戏主题\r\n    @field()\r\n    theme: number = 1;\r\n\r\n    //女孩皮肤是否有尚未领取\r\n    @field()\r\n    isunlock_girl: number = 0;\r\n    @field()\r\n    isunlock_girl1: number = 0;\r\n    @field()\r\n    isunlock_girl2: number = 0;\r\n    @field()\r\n    isunlock_girl3: number = 0;\r\n    @field()\r\n    isunlock_girl4: number = 0;\r\n    @field()\r\n    isunlock_girl5: number = 0;\r\n\r\n\r\n    //老头皮肤是否有尚未领取\r\n    @field()\r\n    isunlock_men: number = 0;\r\n    @field()\r\n    isunlock_men1: number = 0;\r\n    @field()\r\n    isunlock_men2: number = 0;\r\n    @field()\r\n    isunlock_men3: number = 0;\r\n    @field()\r\n    isunlock_men4: number = 0;\r\n    @field()\r\n    isunlock_men5: number = 0;\r\n\r\n    //游戏主题是否有尚未领取\r\n    @field()\r\n    isunlock_theme: number = 0;\r\n\r\n    //钥匙主题\r\n    @field()\r\n    theme_key: number = 1;\r\n\r\n    // //首次提示皮肤强制引导\r\n    // @field()\r\n    // skin_guide: number = 0;\r\n\r\n    get userType() {\r\n        return this.isNew ? \"(新玩家)\" : \"(老玩家)\"\r\n    }\r\n\r\n    exitGame() {\r\n        this.lastExitTime = Date.now() / 1000;\r\n        this.save(\"lastExitTime\")\r\n    }\r\n\r\n    onLoadAll() {\r\n        if (this.firstLoginTime == 0) {\r\n            this.firstLoginTime = Date.now()\r\n        }\r\n        if (gameUtil.isNextDay(this.firstLoginTime)) {\r\n            this.isNew = false;\r\n        } else {\r\n            this.isNew = true;\r\n        }\r\n        if (gameUtil.isNextDay(this.lastLoginTime)) {\r\n            this.lastLoginTime = Date.now();\r\n            this.isFirstLoginToday = true;\r\n            this.isUse = false;\r\n            this.isGetGunStart = false;\r\n            this.isGetGunEnd = false;\r\n            this.sharecount = 0;\r\n            this.kaipingcount = 0;\r\n            this.lose_num = 1\r\n            this.return_num = 1;\r\n            this.gunViewDay = 0;\r\n        } else {\r\n            this.isFirstLoginToday = false;\r\n        }\r\n        // if (gameUtil.isNextDay(this.DyTime)) {\r\n        //     this.isDy = false;\r\n        // } else {\r\n        //     this.isDy = true;\r\n        //     this.isGetDy = false;\r\n        // }\r\n        if (gameUtil.isNextDay(this.kfTime)) {\r\n            this.isKf = false;\r\n        }\r\n        if (gameUtil.isNextDay(this.FirstGameOverTime)) {\r\n            this.isFirstGameOver = true;\r\n        } else {\r\n            this.isFirstGameOver = false;\r\n        }\r\n        if (isEmpty(this.userId)) {\r\n            this.userId = g.uuid(32, 16)\r\n            // Platform.userId = this.userId;\r\n        }\r\n        this.save()\r\n    }\r\n\r\n    /**\r\n     * 上传用户数据 \r\n     * @param kvs \r\n     */\r\n    async uploadUserInfo(kvs: Object) {\r\n        //仅对授权过的用户进行提交数据\r\n        if (isEmpty(UserInfo.userId)) {\r\n            return -1;\r\n        }\r\n        //开始上传\r\n        try {\r\n            let d = {\r\n                // userId: UserInfo.userId,\r\n                // nickName: UserInfo.nickName,\r\n                // avatarUrl: UserInfo.avatarUrl,\r\n                // gender: UserInfo.gender,\r\n                // channel: channel,\r\n            }\r\n            for (var k in kvs) {\r\n                d[k] = kvs[k];\r\n            }\r\n            //上传授权信息\r\n            await WeakNetGame.syncData(JSON.stringify(d))\r\n        } catch (e) {\r\n            console.error(\"上传数据失败\" + e);\r\n            return -2;\r\n        }\r\n        return 0;\r\n    }\r\n    /**\r\n     *  在 WxgetInfoButton 的按钮回调里执行\r\n     * @param kvs 需要上传的key-value 对 数据\r\n     * @param authInfo 从WxgetInfoButton 按钮回调里获取的参数\r\n     * @returns 0 表示成功上传 ,- 1玩家 未授权， -2  上传过程失败\r\n     */\r\n    async openRankAndUpload(kvs: Object, authInfo: AuthUserInfo) {\r\n        if (UserInfo.auth == false) {\r\n            if (!authInfo) {\r\n                authInfo = await Platform.checkAuth()\r\n            }\r\n            //update user info \r\n            if (authInfo == null) {\r\n                //玩家未授权\r\n                return -1;\r\n            } else {\r\n                //已授权 \r\n                UserInfo.nickName = authInfo.nickName;\r\n                if (isEmpty(UserInfo.userId)) {\r\n                    UserInfo.userId = g.uuid(32, 16);\r\n                }\r\n                UserInfo.gender = authInfo.gender;\r\n                UserInfo.avatarUrl = authInfo.avatarUrl;\r\n                UserInfo.auth = true;\r\n                //保存授权信息\r\n                UserInfo.save();\r\n                let channel = '';\r\n                if (CC_WECHATGAME) {\r\n                    if (window.tt) {\r\n                        channel = 'tt'\r\n                    } else if (window.qq) {\r\n                        channel = 'qq'\r\n                    } else {\r\n                        channel = 'wx'\r\n                    }\r\n                } else {\r\n                    channel = 'sim'\r\n                }\r\n                if (kvs == null) { kvs = {} }\r\n                kvs[\"nickName\"] = UserInfo.nickName;\r\n                kvs[\"avatarUrl\"] = UserInfo.avatarUrl;\r\n                kvs[\"gender\"] = UserInfo.gender;\r\n                kvs['channel'] = channel;\r\n                kvs['auth'] = true;\r\n                //开始上传\r\n                return this.uploadUserInfo(kvs);\r\n            }\r\n        }\r\n    }\r\n\r\n    isAuthOk() {\r\n        return !isEmpty(UserInfo.nickName)\r\n    }\r\n    /**检查是否有离线收益 \r\n     * @returns 离线时间  (s)\r\n    */\r\n    checkOffline() {\r\n        if (firstEnterHome) {\r\n            firstEnterHome = false;\r\n            let offset = Date.now() / 1000 - UserInfo.lastExitTime;\r\n            if (offset > 60) {\r\n                return offset;\r\n            }\r\n            return 0\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\nexport let UserInfo: UserInfoDC = DataCenter.register(UserInfoDC);\r\n"]}