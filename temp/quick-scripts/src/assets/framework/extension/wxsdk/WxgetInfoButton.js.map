{"version":3,"sources":["assets\\framework\\extension\\wxsdk\\WxgetInfoButton.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Platform from \"../Platform\";\r\n\r\nconst { ccclass, property, menu } = cc._decorator;\r\nlet wxSysInfo\r\n@ccclass\r\n@menu(\"Wxsdk/WxgetInfoButton\")\r\nexport default class WxgetInfoButton extends cc.Component {\r\n\r\n    @property(cc.Component.EventHandler)\r\n    handler: cc.Component.EventHandler = new cc.Component.EventHandler();\r\n    button: any = null;\r\n    @property\r\n    width: number = 200;\r\n    @property\r\n    height: number = 40;\r\n    onLoad() {\r\n\r\n    }\r\n\r\n    onEnable() {\r\n        this.button && this.button.show();\r\n    }\r\n\r\n    onDisable() {\r\n        this.button && this.button.hide();\r\n    }\r\n\r\n    onDestroy() {\r\n        this.button && this.button.destroy();\r\n    }\r\n    private createButton(callback) {\r\n        if (!wxSysInfo) {\r\n            wxSysInfo = wx.getSystemInfoSync();\r\n        }\r\n        console.log(\"------未授权! 调用wx.createUserInfoButton-------\", wx.getSystemInfoSync().windowWidth)\r\n        var leftPos = wxSysInfo.windowWidth * 0.5 - this.width / 2\r\n        var topPos = wxSysInfo.windowHeight * 0.5 - this.height / 2\r\n        var width = this.width\r\n        var height = this.height\r\n        if (this.button) {\r\n            this.button.destroy()\r\n        }\r\n        var btnRect = this.node.getBoundingBoxToWorld()\r\n        var ratio = cc.view.getDevicePixelRatio();\r\n        var scale = cc.view.getScaleX()\r\n        var factor = scale / ratio\r\n        // var point = cc.v2(btnRect.x, btnRect.y)\r\n        // cc.view._convertPointWithScale(point)\r\n        leftPos = btnRect.x * factor\r\n        topPos = wxSysInfo.screenHeight - (btnRect.y + btnRect.height) * factor\r\n        width = btnRect.width * factor\r\n        height = btnRect.height * factor\r\n        this.button = wx.createUserInfoButton({\r\n            type: \"text\",\r\n            text: \"        \",\r\n            style: {\r\n                left: leftPos,\r\n                top: topPos,\r\n                width: width,\r\n                height: height,\r\n                lineHeight: 60,\r\n                textAlign: 'center',\r\n                backgroundColor: '#00000000',\r\n                color: '#ffffff'\r\n            }\r\n        });\r\n        this.button.onTap((res) => {\r\n            if (res && res.userInfo) {\r\n                console.log(\"res\", res)\r\n                this.button.destroy();\r\n                if (callback) {\r\n                    callback(res.userInfo);\r\n                }\r\n            } else if (callback) {\r\n                callback(null);\r\n            }\r\n        });\r\n    }\r\n    start() {\r\n        Platform.checkAuth().then(v => {\r\n            if (!v) {\r\n                if (CC_WECHATGAME) {\r\n                    this.createButton(userInfo => {\r\n                        this.onClick(userInfo, true)\r\n                    })\r\n                }\r\n            } else {\r\n                this.node.on(cc.Node.EventType.TOUCH_END, this.onClick.bind(this, v, false))\r\n                // this.handler.emit([v])\r\n                //n已授权无需创建 按钮\r\n                // this.infoHandler.emit([v])\r\n            }\r\n        })\r\n    }\r\n\r\n    onClick(userInfo, isNew) {\r\n        this.handler.emit([userInfo, isNew])\r\n    }\r\n}"]}