{"version":3,"sources":["assets\\framework\\ui\\controller\\Draggable.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Signal from \"../../core/Signal\";\r\n\r\nconst { ccclass, property, menu } = cc._decorator;\r\n\r\n@ccclass\r\n@menu(\"Controller/Draggable\")\r\nexport default class Draggable extends cc.Component {\r\n\r\n    onDragStart: Signal = new Signal();\r\n    onDragMove: Signal = new Signal();\r\n    onDragEnd: Signal = new Signal();\r\n    onDragCancel: Signal = new Signal();\r\n\r\n    @property({ displayName: \"是否可以拖出屏幕\" })\r\n    public oosEnabled = false;\r\n\r\n    // @property({ displayName: \"是否可以拖出屏幕\" })\r\n    // public isDir = [horizontal,];\r\n\r\n    @property({ displayName: \"是否可以拖动Y\" })\r\n    public yEnabled = true;\r\n\r\n\r\n    @property\r\n    moveBackDur: number = 0.5;\r\n\r\n    onLoad() {\r\n\r\n    }\r\n\r\n    start() {\r\n\r\n\r\n    }\r\n\r\n    onEnable() {\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchBegan, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMoved, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnded, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCanceled, this);\r\n    }\r\n\r\n    onDisable(){\r\n        this.node.off(cc.Node.EventType.TOUCH_START, this.onTouchBegan, this);\r\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMoved, this);\r\n        this.node.off(cc.Node.EventType.TOUCH_END, this.onTouchEnded, this);\r\n        this.node.off(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCanceled, this);\r\n    }\r\n\r\n    offset: cc.Vec2;\r\n\r\n    dragStartPos: cc.Vec2;\r\n\r\n    last: cc.Vec2;\r\n\r\n\r\n    onTouchBegan(evt) {\r\n        let v = evt.getLocation();\r\n        this.dragStartPos = this.node.position;\r\n        this.onDragStart.fire(v)\r\n        evt.stopPropagation();\r\n        this.isDrag = false;\r\n        this.isDragging = true;\r\n        this.last = this.node.parent.convertToNodeSpaceAR(v);\r\n        this.offset = this.node.position.sub(this.last);\r\n    }\r\n\r\n    isDrag = false;\r\n\r\n    isDragging = false;\r\n\r\n    onTouchMoved(evt) {\r\n        let v = evt.getLocation()\r\n        // console.log(this.offset);\r\n        // this.node.position = v.sub(this.offset);\r\n        // let heroRigidBody = this.node.getComponent(cc.RigidBody);\r\n        // heroRigidBody.applyLinearImpulse(evt.touch.getDelta(),\r\n        //     heroRigidBody.getWorldCenter(),\r\n        //     true\r\n        // );\r\n        if (this.yEnabled) {\r\n            let cur = this.node.parent.convertToNodeSpaceAR(v);\r\n            let p = cur.addSelf(this.offset)\r\n            this.node.position = p;\r\n            this.isDrag = true;\r\n            this.last = cur;\r\n            return;\r\n        }\r\n        if (evt.touch.getDelta().x > 20) {\r\n            let offset = cc.v2(20, evt.touch.getDelta().y);\r\n            this.node.x += offset.x;\r\n            // if (this.yEnabled)\r\n            //     this.node.y += offset.y;\r\n        } else if (evt.touch.getDelta().x < -20) {\r\n            let offset = cc.v2(-20, evt.touch.getDelta().y);\r\n            this.node.x += offset.x;\r\n\r\n            //this.node.y += offset.y;\r\n        } else {\r\n            this.node.x += evt.touch.getDelta().x;\r\n            // if (this.yEnabled)\r\n            //     this.node.y += evt.touch.getDelta().y;\r\n        }\r\n\r\n        this.onDragMove.fire(evt.touch.getDelta());\r\n\r\n        this.isDrag = true;\r\n    }\r\n\r\n    onTouchEnded(evt) {\r\n        this.isDragging = false;\r\n        if (this.isDrag == false) return;\r\n        let v = evt.getLocation()\r\n        this.onDragEnd.fire(v)\r\n        if (!this.oosEnabled) {\r\n            if (!cc.Camera.main.canSee(this.node)) {\r\n                this.moveBack();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    onTouchCanceled(evt) {\r\n        this.isDragging = false;\r\n        let v = evt.getLocation()\r\n        this.onDragCancel.fire(v)\r\n        if (!this.oosEnabled) {\r\n            if (!cc.Camera.main.canSee(this.node)) {\r\n                this.moveBack();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    moveBack() {\r\n        this.node.runAction(cc.moveTo(this.moveBackDur, this.dragStartPos).easing(cc.easeBackInOut));\r\n    }\r\n}"]}